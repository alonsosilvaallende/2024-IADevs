<!DOCTYPE html>
<html lang="en"><head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="IADevs_files/libs/clipboard/clipboard.min.js"></script>
<script src="IADevs_files/libs/quarto-html/tabby.min.js"></script>
<script src="IADevs_files/libs/quarto-html/popper.min.js"></script>
<script src="IADevs_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="IADevs_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="IADevs_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="IADevs_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="IADevs_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.4.528">

  <meta name="author" content="Alonso Silva (Github: alonsosilvaallende)">
  <title>Potenciando la generación aumentada usando recuperación con grafos de conocimiento</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="IADevs_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="IADevs_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="IADevs_files/libs/revealjs/dist/theme/quarto.css">
  <link href="IADevs_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="IADevs_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="IADevs_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="IADevs_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Potenciando la generación aumentada usando recuperación con grafos de conocimiento</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Alonso Silva (Github: alonsosilvaallende) 
</div>
</div>
</div>

</section><section id="TOC">
<nav role="doc-toc"> 
<h2 id="toc-title">Table of contents</h2>
<ul>
<li><a href="#/introduction" id="/toc-introduction">Introduction</a></li>
<li><a href="#/vector-only-retrieval" id="/toc-vector-only-retrieval">Vector-only retrieval</a></li>
<li><a href="#/graph-only-retrieval" id="/toc-graph-only-retrieval">Graph-only retrieval</a></li>
<li><a href="#/combining-graph-and-vector-retrieval" id="/toc-combining-graph-and-vector-retrieval">Combining graph and vector retrieval</a></li>
<li><a href="#/what-is-structured-generation" id="/toc-what-is-structured-generation">What is Structured Generation?</a></li>
<li><a href="#/knowledge-graph-generation" id="/toc-knowledge-graph-generation">Knowledge Graph Generation</a></li>
<li><a href="#/kg-based-agents" id="/toc-kg-based-agents">KG-based Agents</a></li>
<li><a href="#/conclusions" id="/toc-conclusions">Conclusions</a></li>
</ul>
</nav>
</section>
<section id="hi-im-alonso" class="slide level3 smaller">
<h3>hi 👋, I’m Alonso</h3>
<ul>
<li>Researcher on Generative AI at Nokia Bell Labs</li>
<li>AI Consultant/Trainer</li>
<li>PhD at Inria, post-doc at UC Berkeley</li>
<li>Based in Paris, France</li>
<li><a href="https://alonsosilvaallende.github.io/">https://alonsosilvaallende.github.io/</a>
<ul>
<li>Github: <a href="https://github.com/alonsosilvaallende/">https://github.com/alonsosilvaallende/</a></li>
<li>Twitter: <a href="https://twitter.com/alonsosilva"><span class="citation" data-cites="alonsosilva">@alonsosilva</span></a></li>
<li>Bluesky: <a href="https://bsky.app/profile/alonsosilva.bsky.social">https://bsky.app/profile/alonsosilva.bsky.social</a></li>
<li>Mastodon: <a href="https://sigmoid.social/@alonsosilva">https://sigmoid.social/<span class="citation" data-cites="alonsosilva">@alonsosilva</span></a></li>
<li>Linkedin: <a href="https://www.linkedin.com/in/alonsosilvaallende/">https://www.linkedin.com/in/alonsosilvaallende/</a></li>
</ul></li>
</ul>
</section>
<section id="section" class="slide level3">
<h3></h3>
<ul>
<li>Slides: <a href="https://alonsosilvaallende.github.io/2024-PyData-Global/">alonsosilvaallende.github.io/2024-PyData-Global/</a></li>
<li>This presentation: <a href="https://github.com/alonsosilvaallende/2024-PyData-Global/blob/main/PyData-Global.ipynb">https://github.com/alonsosilvaallende/2024-PyData-Global/blob/main/PyData-Global.ipynb</a></li>
</ul>
</section>
<section>
<section id="introduction" class="title-slide slide level1 center">
<h1>Introduction</h1>

</section>
<section id="data" class="slide level3">
<h3>Data</h3>
<div id="0c683dc0-9642-41f3-9309-0f653db224f2" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:42:55.494063Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:42:55.493155Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:42:59.013222Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:42:59.012046Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:42:55.494013Z&quot;}" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href=""></a><span class="im">import</span> polars <span class="im">as</span> pl</span>
<span id="cb1-2"><a href=""></a><span class="im">import</span> string</span>
<span id="cb1-3"><a href=""></a></span>
<span id="cb1-4"><a href=""></a>df <span class="op">=</span> pl.read_csv(</span>
<span id="cb1-5"><a href=""></a>    <span class="st">"https://drive.google.com/uc?export=download&amp;id=1uD3h7xYxr9EoZ0Ggoh99JtQXa3AxtxyU"</span></span>
<span id="cb1-6"><a href=""></a>)</span>
<span id="cb1-7"><a href=""></a>df <span class="op">=</span> df.with_columns(</span>
<span id="cb1-8"><a href=""></a>    pl.Series(<span class="st">"Album"</span>, [string.capwords(album) <span class="cf">for</span> album <span class="kw">in</span> df[<span class="st">"Album"</span>]])</span>
<span id="cb1-9"><a href=""></a>)</span>
<span id="cb1-10"><a href=""></a>df <span class="op">=</span> df.with_columns(</span>
<span id="cb1-11"><a href=""></a>    pl.Series(<span class="st">"Song"</span>, [string.capwords(song) <span class="cf">for</span> song <span class="kw">in</span> df[<span class="st">"Song"</span>]])</span>
<span id="cb1-12"><a href=""></a>)</span>
<span id="cb1-13"><a href=""></a>df <span class="op">=</span> df.with_columns(pl.col(<span class="st">"Lyrics"</span>).fill_null(<span class="st">"None"</span>))</span>
<span id="cb1-14"><a href=""></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 4)</small>
<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Song</th>
<th data-quarto-table-cell-role="th">Lyrics</th>
<th data-quarto-table-cell-role="th">Album</th>
<th data-quarto-table-cell-role="th">Artist</th>
</tr>
<tr class="odd">
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Don't Tread On Me"</td>
<td>"Liberty or death what we so pr…</td>
<td>"The Black Album"</td>
<td>"Metallica"</td>
</tr>
<tr class="even">
<td>"Nothing Else Matters"</td>
<td>"So close no matter how far cou…</td>
<td>"The Black Album"</td>
<td>"Metallica"</td>
</tr>
<tr class="odd">
<td>"Through The Never"</td>
<td>"All that is was and will be un…</td>
<td>"The Black Album"</td>
<td>"Metallica"</td>
</tr>
<tr class="even">
<td>"My Friend Of Misery"</td>
<td>"You just stood there screaming…</td>
<td>"The Black Album"</td>
<td>"Metallica"</td>
</tr>
<tr class="odd">
<td>"Wherever I May Roam"</td>
<td>"...and the road becomes my bri…</td>
<td>"The Black Album"</td>
<td>"Metallica"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="potential-kind-of-queries" class="slide level3">
<h3>Potential kind of queries</h3>
<div id="64162c3c-84f3-42cf-b576-0eee0490df78" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:42:59.021322Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:42:59.020725Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:42:59.044879Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:42:59.043575Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:42:59.021268Z&quot;}" data-execution_count="4">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href=""></a>queries <span class="op">=</span> [</span>
<span id="cb2-2"><a href=""></a>    <span class="st">"Which song is about a boy who is having nightmares?"</span>,</span>
<span id="cb2-3"><a href=""></a>    <span class="st">"Which song is about a guy who is so badly wounded in war so he no longer has any senses?"</span>,</span>
<span id="cb2-4"><a href=""></a>    <span class="st">"How many songs does the reload album have?"</span>,</span>
<span id="cb2-5"><a href=""></a>    <span class="st">"Which songs does the black album have?"</span></span>
<span id="cb2-6"><a href=""></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section>
<section>
<section id="vector-only-retrieval" class="title-slide slide level1 center">
<h1>Vector-only retrieval</h1>

</section>
<section id="vector-only-retrieval-1" class="title-slide slide level2 center">
<h2>Vector-only retrieval</h2>
<div id="ce5545b6-db09-4533-8097-224cf8745e64" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:42:59.062261Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:42:59.061315Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:42:59.074725Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:42:59.073378Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:42:59.062216Z&quot;}" data-execution_count="6">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href=""></a>df <span class="op">=</span> df.with_columns(</span>
<span id="cb3-2"><a href=""></a>    text<span class="op">=</span>pl.lit(<span class="st">"# "</span>)</span>
<span id="cb3-3"><a href=""></a>    <span class="op">+</span> pl.col(<span class="st">"Album"</span>)</span>
<span id="cb3-4"><a href=""></a>    <span class="op">+</span> pl.lit(<span class="st">": "</span>)</span>
<span id="cb3-5"><a href=""></a>    <span class="op">+</span> pl.col(<span class="st">"Song"</span>)</span>
<span id="cb3-6"><a href=""></a>    <span class="op">+</span> pl.lit(<span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>)</span>
<span id="cb3-7"><a href=""></a>    <span class="op">+</span> pl.col(<span class="st">"Lyrics"</span>)</span>
<span id="cb3-8"><a href=""></a>)</span>
<span id="cb3-9"><a href=""></a></span>
<span id="cb3-10"><a href=""></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 5)</small>
<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Song</th>
<th data-quarto-table-cell-role="th">Lyrics</th>
<th data-quarto-table-cell-role="th">Album</th>
<th data-quarto-table-cell-role="th">Artist</th>
<th data-quarto-table-cell-role="th">text</th>
</tr>
<tr class="odd">
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Don't Tread On Me"</td>
<td>"Liberty or death what we so pr…</td>
<td>"The Black Album"</td>
<td>"Metallica"</td>
<td>"# The Black Album: Don't Tread…</td>
</tr>
<tr class="even">
<td>"Nothing Else Matters"</td>
<td>"So close no matter how far cou…</td>
<td>"The Black Album"</td>
<td>"Metallica"</td>
<td>"# The Black Album: Nothing Els…</td>
</tr>
<tr class="odd">
<td>"Through The Never"</td>
<td>"All that is was and will be un…</td>
<td>"The Black Album"</td>
<td>"Metallica"</td>
<td>"# The Black Album: Through The…</td>
</tr>
<tr class="even">
<td>"My Friend Of Misery"</td>
<td>"You just stood there screaming…</td>
<td>"The Black Album"</td>
<td>"Metallica"</td>
<td>"# The Black Album: My Friend O…</td>
</tr>
<tr class="odd">
<td>"Wherever I May Roam"</td>
<td>"...and the road becomes my bri…</td>
<td>"The Black Album"</td>
<td>"Metallica"</td>
<td>"# The Black Album: Wherever I …</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>

<section id="vector-only-retrieval-2" class="title-slide slide level2 center">
<h2>Vector-only retrieval</h2>
<div id="d23c41c4-ebe2-4af9-a7a5-0b1a088b4d0f" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:42:59.077021Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:42:59.076043Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:42:59.083694Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:42:59.082383Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:42:59.076965Z&quot;}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href=""></a><span class="bu">print</span>(df.select(<span class="st">"text"</span>)[<span class="dv">1</span>].item()[:<span class="dv">300</span>])</span>
<span id="cb4-2"><a href=""></a><span class="bu">print</span>(<span class="st">"..."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># The Black Album: Nothing Else Matters

So close no matter how far
couldn't be much more from the heart
forever trusting who we are
and nothing else matters
never opened myself this way
life is ours
we live it our way
all these words I don't just say
and nothing else matters
trust I seek and I find
...</code></pre>
</div>
</div>
</section>

<section id="vector-only-retrieval-3" class="title-slide slide level2 center">
<h2>Vector-only retrieval</h2>
<div id="77714984-e16b-4498-860f-7fee655a9df4" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:42:59.085438Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:42:59.085025Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:42:59.557067Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:42:59.556366Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:42:59.085399Z&quot;}" data-execution_count="8">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href=""></a><span class="im">import</span> shutil</span>
<span id="cb6-2"><a href=""></a><span class="im">import</span> lancedb</span>
<span id="cb6-3"><a href=""></a></span>
<span id="cb6-4"><a href=""></a>shutil.rmtree(<span class="st">"lancedb_explorer"</span>, ignore_errors<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-5"><a href=""></a>db <span class="op">=</span> lancedb.<span class="ex">connect</span>(<span class="st">"lancedb_explorer"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="vector-only-retrieval-4" class="title-slide slide level2 center">
<h2>Vector-only retrieval</h2>
<div id="c20058dd-85e6-429c-aeab-f3e20a6fe4b5" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:42:59.557821Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:42:59.557632Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:42:59.561174Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:42:59.560544Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:42:59.557808Z&quot;}" data-execution_count="9">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href=""></a><span class="im">from</span> lancedb.embeddings <span class="im">import</span> get_registry</span>
<span id="cb7-2"><a href=""></a></span>
<span id="cb7-3"><a href=""></a>embeddings <span class="op">=</span> (</span>
<span id="cb7-4"><a href=""></a>    get_registry()</span>
<span id="cb7-5"><a href=""></a>    .get(<span class="st">"sentence-transformers"</span>)</span>
<span id="cb7-6"><a href=""></a>    .create(name<span class="op">=</span><span class="st">"TaylorAI/gte-tiny"</span>, device<span class="op">=</span><span class="st">"cuda"</span>)</span>
<span id="cb7-7"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="vector-only-retrieval-5" class="title-slide slide level2 center">
<h2>Vector-only retrieval</h2>
<div id="edd4be7f-59d0-43c1-a0eb-d72f8b99768b" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:42:59.561665Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:42:59.561518Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:10.438165Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:10.437256Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:42:59.561650Z&quot;}" data-execution_count="10">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href=""></a><span class="im">from</span> lancedb.pydantic <span class="im">import</span> LanceModel, Vector</span>
<span id="cb8-2"><a href=""></a></span>
<span id="cb8-3"><a href=""></a><span class="kw">class</span> Songs(LanceModel):</span>
<span id="cb8-4"><a href=""></a>    Song: <span class="bu">str</span></span>
<span id="cb8-5"><a href=""></a>    Lyrics: <span class="bu">str</span></span>
<span id="cb8-6"><a href=""></a>    Album: <span class="bu">str</span></span>
<span id="cb8-7"><a href=""></a>    Artist: <span class="bu">str</span></span>
<span id="cb8-8"><a href=""></a>    text: <span class="bu">str</span> <span class="op">=</span> embeddings.SourceField()</span>
<span id="cb8-9"><a href=""></a>    vector: Vector(embeddings.ndims()) <span class="op">=</span> embeddings.VectorField()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="vector-only-retrieval-6" class="title-slide slide level2 center">
<h2>Vector-only retrieval</h2>
<div id="16ddf216-1f98-4a87-85c5-94af61ecd17b" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:10.440107Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:10.439327Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:10.777857Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:10.776878Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:10.440062Z&quot;}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href=""></a>table <span class="op">=</span> db.create_table(<span class="st">"Songs"</span>, schema<span class="op">=</span>Songs)</span>
<span id="cb9-2"><a href=""></a>table.add(data<span class="op">=</span>df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="vector-only-retrieval-7" class="title-slide slide level2 center">
<h2>Vector-only retrieval</h2>
<div id="3d8276d5-5c46-4dc9-b151-064ab2947169" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:10.783097Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:10.782928Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:10.833813Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:10.833060Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:10.783080Z&quot;}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href=""></a>query <span class="op">=</span> <span class="st">"Which song is about a boy who is having nightmares?"</span></span>
<span id="cb10-2"><a href=""></a>results <span class="op">=</span> table.search(query).limit(<span class="dv">10</span>).to_polars()</span>
<span id="cb10-3"><a href=""></a>results[<span class="st">"Song"</span>].to_list()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>['Enter Sandman',
 'The Thing That Should Not Be',
 'Hero Of The Day',
 'The Thing That Should Not Be',
 'Hero Of The Day',
 'Invisible Kid',
 'Enter Sandman',
 'Sad But True',
 'My Friend Of Misery',
 'One']</code></pre>
</div>
</div>
</section>

<section id="vector-only-retrieval-8" class="title-slide slide level2 center">
<h2>Vector-only retrieval</h2>
<div id="44acbc4b-6ca3-4428-934a-8340ad1fffef" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:10.834917Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:10.834603Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:10.857399Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:10.856410Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:10.834891Z&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href=""></a>query <span class="op">=</span> <span class="st">"""Which song is about a guy who is so badly wounded in war</span></span>
<span id="cb12-2"><a href=""></a><span class="st">so he no longer has any senses?"""</span></span>
<span id="cb12-3"><a href=""></a>results <span class="op">=</span> table.search(query).limit(<span class="dv">10</span>).to_polars()</span>
<span id="cb12-4"><a href=""></a>results[<span class="st">"Song"</span>].to_list()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>['Phantom Lord',
 'One',
 'No Remorse',
 'One',
 'My Friend Of Misery',
 "Low Man's Lyric",
 'The Unforgiven',
 'Sad But True',
 "Don't Tread On Me",
 '2x4']</code></pre>
</div>
</div>
</section>

<section id="vector-only-retrieval-9" class="title-slide slide level2 center">
<h2>Vector-only retrieval</h2>
<p><a href="https://alonsosilva-song-finder.hf.space">https://alonsosilva-song-finder.hf.space</a></p>
<div id="96be5f5c-f3a0-491f-9189-cba6e4824091" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:10.858707Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:10.858306Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:10.865214Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:10.864279Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:10.858678Z&quot;}" data-execution_count="15">
<div class="cell-output cell-output-display" data-execution_count="15">

        <iframe width="850" height="450" src="https://alonsosilva-song-finder.hf.space" frameborder="0" allowfullscreen=""></iframe>
        
</div>
</div>
</section>

<section id="retrieval-augmented-generation-rag" class="title-slide slide level2 center">
<h2>Retrieval Augmented Generation (RAG)</h2>
<div id="396623b9-7597-44dc-97f8-cb695d3ef6ba" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:10.866746Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:10.866344Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:13.023820Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:13.022902Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:10.866704Z&quot;}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href=""></a><span class="im">import</span> llama_cpp</span>
<span id="cb14-2"><a href=""></a></span>
<span id="cb14-3"><a href=""></a>llm <span class="op">=</span> llama_cpp.Llama(</span>
<span id="cb14-4"><a href=""></a>    <span class="st">"/big_storage/llms/models/Hermes-3-Llama-3.1-8B.Q6_K.gguf"</span>,</span>
<span id="cb14-5"><a href=""></a>    tokenizer<span class="op">=</span>llama_cpp.llama_tokenizer.LlamaHFTokenizer.from_pretrained(</span>
<span id="cb14-6"><a href=""></a>        <span class="st">"NousResearch/Hermes-3-Llama-3.1-8B"</span></span>
<span id="cb14-7"><a href=""></a>    ),</span>
<span id="cb14-8"><a href=""></a>    n_gpu_layers<span class="op">=-</span><span class="dv">1</span>,</span>
<span id="cb14-9"><a href=""></a>    flash_attn<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb14-10"><a href=""></a>    n_ctx<span class="op">=</span><span class="dv">8192</span>,</span>
<span id="cb14-11"><a href=""></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb14-12"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="retrieval-augmented-generation-rag-1" class="title-slide slide level2 center">
<h2>Retrieval Augmented Generation (RAG)</h2>
<div id="1baa8b46-0277-4807-8bb2-815941830a3a" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:13.024656Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:13.024499Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:13.039997Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:13.039338Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:13.024642Z&quot;}" data-scrolled="true" data-execution_count="17">
<div class="sourceCode cell-code" id="cb15" data-code-line-numbers="1|3-5|7|1-9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href=""></a><span class="kw">def</span> get_relevant_texts(query):</span>
<span id="cb15-2"><a href=""></a>    results <span class="op">=</span> (</span>
<span id="cb15-3"><a href=""></a>        table.search(query)</span>
<span id="cb15-4"><a href=""></a>             .limit(<span class="dv">5</span>)</span>
<span id="cb15-5"><a href=""></a>             .to_polars()</span>
<span id="cb15-6"><a href=""></a>    )</span>
<span id="cb15-7"><a href=""></a>    <span class="cf">return</span> <span class="st">" "</span>.join([results[<span class="st">"text"</span>][i] <span class="op">+</span> <span class="st">"</span><span class="ch">\n\n</span><span class="st">---</span><span class="ch">\n\n</span><span class="st">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)])</span>
<span id="cb15-8"><a href=""></a></span>
<span id="cb15-9"><a href=""></a><span class="bu">print</span>(get_relevant_texts(query))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Kill 'em All: Phantom Lord

Sound is ripping through your ears
The deafening sound of metal nears
Your bodies waiting for his whips
The taste of leather on your lips
Hear the cry of war
Louder than before
With his sword in hand
To control the land
Crushing metal strikes
On this frightening night
Fall onto your knees
For the phantom lord
Victims falling under chains
You hear them crying dying pains
The fist of terrors breaking through
Now there's nothing you can do
Hear the cry of war
Louder than before
With his sword in hand
To control the land
Crushing metal strikes
On this frightening night
Fall onto your knees
For the phantom lord
The leather armies have prevailed
The phantom lord has never failed
Smoke is lifting from the ground
The rising volume metal sound
Hear the cry of war
Louder than before
With his sword in hand
To control the land
Crushing metal strikes
On this frightening night
Fall onto your knees
For the phantom lord
Fall to your knees
And bow to the phantom lord

---

 # And Justice For All..: One

I Can't Remember Anything
Can't Tell If this Is True or Dream
Deep down Inside I Feel to Scream
this Terrible Silence Stops Me
Now That the War Is Through with Me
I'm Waking up I Can Not See
That There Is Not Much Left of Me
Nothing Is Real but Pain Now
Hold My Breath as I Wish for Death
Oh Please God,wake Me
Back in the Womb its Much Too Real
in Pumps Life That I must Feel
but Can't Look Forward to Reveal
Look to the Time When I'll Live
Fed Through the Tube That Sticks in Me
Just like a Wartime Novelty
Tied to Machines That Make Me Be
Cut this Life off from Me
Hold My Breath as I Wish for Death
Oh Please God,wake Me
Now the World Is Gone I'm Just One
Oh God,help Me Hold My Breath as I Wish for Death
Oh Please God Help Me
Darkness
Imprisoning Me
All That I See
Absolute Horror
I Cannot Live
I Cannot Die
Trapped in Myself
Body My Holding Cell
Landmine
Has Taken My Sight
Taken My Speech
Taken My Hearing
Taken My Arms
Taken My Legs
Taken My Soul
Left Me with Life in Hell

---

 # Kill 'em All: No Remorse

No mercy for what we are doing
No thought to even what we have done
We don't need to feel the sorrow
No remorse for the helpless one
War without end
No remorse no repent
We don't care what it meant
Another day another death
Another sorrow another breath
No remorse no repent
We don't care what it meant
Another day another death
Another sorrow another breath
Blood feeds the war machine
As it eats its way across the land
We don't need to feel the sorrow
No remorse is the one command
War without end
No remorse no repent
We don't care what it meant
Another day another death
Another sorrow another breath
No remorse no repent
We don't care what it meant
Another day another death
Another sorrow another breath
Only the strong survive
No one to save the weaker race
We are ready to kill all comers
Like a loaded gun right at your face
War without end
No remorse no repent
We don't care what it meant
Another day another death
Another sorrow another breath
No remorse no repent
We don't care what it meant
Another day another death
Another sorrow another breath
Attack
Bullets are flying
People are dying
With madness surrounding all hell's breaking loose
Soldiers are hounding
Bodies are mounting
Cannons are shouting to take their abuse
With war machines going
Blood starts to flowing
No mercy given to anyone hear
The furious fighting
Swords are like lighting
It all becomes frightening to you
Know death is near
No remorse

---

 # S&amp;m: One

I can't remember anything
Can't tell if this is true or dream
Deep down
inside I feel to scream
This terrible silence stops me
Now that the war is through with me
I'm waking up, I cannot see
That
there's not much left of me
Nothing is real but pain now
Hold my breath as I wish for death
Oh please God, wake me
Back in the womb it's much to real
In pumps life that I must feel
But
can't look forward to reveal
Look to the time when I lived
Fed through the tube that sticks in me
Just like a wartime novelty
Tied
to machines that make me be
Cut this shit out from me
Hold my breath as I wish for death
Oh please God, wake me
Please God
wake me!
Now the world is gone I'm just one
Oh God, help me
Hold my breath as I
wish for death
Oh please God, help me, help me!!
Darkness
Imprisoning me
All that I see
Absolute horror
I cannot
live
I cannot die
Trapped in myself
Body my holding cell
Landmine
Has taken my sight
Taken my speech
Taken my
hearing
Taken my arms
Taken my legs
Taken my soul
Left me with life
in hell 
no, NO, NO NO NO NO NO!!!

---

 # The Black Album: My Friend Of Misery

You just stood there screaming
fearing no one was listening to you
they say the empty can rattles the most
the sound of your voice must soothe you
hearing only what you want to hear
and knowing only what you've heard
you you're smothered in tragedy
you're out to save the world
misery
you insist that the weight of the world
should be on your shoulders
misery
there's much more to life than what you see
my friend of misery
you still stood there screaming
no one caring about these words you tell
my friend before your voice is gone
one man's fun is another's hell
these times are sent to try men's souls
but something's wrong with all you see
you you'll take it on all yourself
remember
misery loves company
misery
you insist that the weight of the world
should be on your shoulders
misery
there's much more to life than what you see
my friend of misery
you just stood there creaming
my friend of misery

---

</code></pre>
</div>
</div>
</section>

<section id="retrieval-augmented-generation-rag-2" class="title-slide slide level2 center">
<h2>Retrieval Augmented Generation (RAG)</h2>
<div id="f4d2f277-f6d9-42df-8bcf-ebad8e157149" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:13.040506Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:13.040359Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:13.061523Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:13.060804Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:13.040491Z&quot;}" data-scrolled="true" data-execution_count="18">
<div class="sourceCode cell-code" id="cb17" data-code-line-numbers="3-4|5-6|1-9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href=""></a><span class="kw">def</span> build_prompt(query):</span>
<span id="cb17-2"><a href=""></a>    <span class="cf">return</span> (</span>
<span id="cb17-3"><a href=""></a>        <span class="st">"Answer the question based only on the following context:</span><span class="ch">\n\n</span><span class="st">"</span></span>
<span id="cb17-4"><a href=""></a>        <span class="op">+</span> get_relevant_texts(query)</span>
<span id="cb17-5"><a href=""></a>        <span class="op">+</span> <span class="st">"</span><span class="ch">\n\n</span><span class="st">Question: "</span></span>
<span id="cb17-6"><a href=""></a>        <span class="op">+</span> query</span>
<span id="cb17-7"><a href=""></a>    )</span>
<span id="cb17-8"><a href=""></a></span>
<span id="cb17-9"><a href=""></a><span class="bu">print</span>(build_prompt(query))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Answer the question based only on the following context:

# Kill 'em All: Phantom Lord

Sound is ripping through your ears
The deafening sound of metal nears
Your bodies waiting for his whips
The taste of leather on your lips
Hear the cry of war
Louder than before
With his sword in hand
To control the land
Crushing metal strikes
On this frightening night
Fall onto your knees
For the phantom lord
Victims falling under chains
You hear them crying dying pains
The fist of terrors breaking through
Now there's nothing you can do
Hear the cry of war
Louder than before
With his sword in hand
To control the land
Crushing metal strikes
On this frightening night
Fall onto your knees
For the phantom lord
The leather armies have prevailed
The phantom lord has never failed
Smoke is lifting from the ground
The rising volume metal sound
Hear the cry of war
Louder than before
With his sword in hand
To control the land
Crushing metal strikes
On this frightening night
Fall onto your knees
For the phantom lord
Fall to your knees
And bow to the phantom lord

---

 # And Justice For All..: One

I Can't Remember Anything
Can't Tell If this Is True or Dream
Deep down Inside I Feel to Scream
this Terrible Silence Stops Me
Now That the War Is Through with Me
I'm Waking up I Can Not See
That There Is Not Much Left of Me
Nothing Is Real but Pain Now
Hold My Breath as I Wish for Death
Oh Please God,wake Me
Back in the Womb its Much Too Real
in Pumps Life That I must Feel
but Can't Look Forward to Reveal
Look to the Time When I'll Live
Fed Through the Tube That Sticks in Me
Just like a Wartime Novelty
Tied to Machines That Make Me Be
Cut this Life off from Me
Hold My Breath as I Wish for Death
Oh Please God,wake Me
Now the World Is Gone I'm Just One
Oh God,help Me Hold My Breath as I Wish for Death
Oh Please God Help Me
Darkness
Imprisoning Me
All That I See
Absolute Horror
I Cannot Live
I Cannot Die
Trapped in Myself
Body My Holding Cell
Landmine
Has Taken My Sight
Taken My Speech
Taken My Hearing
Taken My Arms
Taken My Legs
Taken My Soul
Left Me with Life in Hell

---

 # Kill 'em All: No Remorse

No mercy for what we are doing
No thought to even what we have done
We don't need to feel the sorrow
No remorse for the helpless one
War without end
No remorse no repent
We don't care what it meant
Another day another death
Another sorrow another breath
No remorse no repent
We don't care what it meant
Another day another death
Another sorrow another breath
Blood feeds the war machine
As it eats its way across the land
We don't need to feel the sorrow
No remorse is the one command
War without end
No remorse no repent
We don't care what it meant
Another day another death
Another sorrow another breath
No remorse no repent
We don't care what it meant
Another day another death
Another sorrow another breath
Only the strong survive
No one to save the weaker race
We are ready to kill all comers
Like a loaded gun right at your face
War without end
No remorse no repent
We don't care what it meant
Another day another death
Another sorrow another breath
No remorse no repent
We don't care what it meant
Another day another death
Another sorrow another breath
Attack
Bullets are flying
People are dying
With madness surrounding all hell's breaking loose
Soldiers are hounding
Bodies are mounting
Cannons are shouting to take their abuse
With war machines going
Blood starts to flowing
No mercy given to anyone hear
The furious fighting
Swords are like lighting
It all becomes frightening to you
Know death is near
No remorse

---

 # S&amp;m: One

I can't remember anything
Can't tell if this is true or dream
Deep down
inside I feel to scream
This terrible silence stops me
Now that the war is through with me
I'm waking up, I cannot see
That
there's not much left of me
Nothing is real but pain now
Hold my breath as I wish for death
Oh please God, wake me
Back in the womb it's much to real
In pumps life that I must feel
But
can't look forward to reveal
Look to the time when I lived
Fed through the tube that sticks in me
Just like a wartime novelty
Tied
to machines that make me be
Cut this shit out from me
Hold my breath as I wish for death
Oh please God, wake me
Please God
wake me!
Now the world is gone I'm just one
Oh God, help me
Hold my breath as I
wish for death
Oh please God, help me, help me!!
Darkness
Imprisoning me
All that I see
Absolute horror
I cannot
live
I cannot die
Trapped in myself
Body my holding cell
Landmine
Has taken my sight
Taken my speech
Taken my
hearing
Taken my arms
Taken my legs
Taken my soul
Left me with life
in hell 
no, NO, NO NO NO NO NO!!!

---

 # The Black Album: My Friend Of Misery

You just stood there screaming
fearing no one was listening to you
they say the empty can rattles the most
the sound of your voice must soothe you
hearing only what you want to hear
and knowing only what you've heard
you you're smothered in tragedy
you're out to save the world
misery
you insist that the weight of the world
should be on your shoulders
misery
there's much more to life than what you see
my friend of misery
you still stood there screaming
no one caring about these words you tell
my friend before your voice is gone
one man's fun is another's hell
these times are sent to try men's souls
but something's wrong with all you see
you you'll take it on all yourself
remember
misery loves company
misery
you insist that the weight of the world
should be on your shoulders
misery
there's much more to life than what you see
my friend of misery
you just stood there creaming
my friend of misery

---



Question: Which song is about a guy who is so badly wounded in war
so he no longer has any senses?</code></pre>
</div>
</div>
</section>

<section id="retrieval-augmented-generation-rag-3" class="title-slide slide level2 center">
<h2>Retrieval Augmented Generation (RAG)</h2>
<div id="d55e213f-4a17-480b-af86-232a05e52aca" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:13.062517Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:13.062210Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:13.066368Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:13.065697Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:13.062497Z&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href=""></a><span class="kw">def</span> generate_response(query):</span>
<span id="cb19-2"><a href=""></a>    prompt <span class="op">=</span> build_prompt(query)</span>
<span id="cb19-3"><a href=""></a>    response <span class="op">=</span> llm.create_chat_completion(</span>
<span id="cb19-4"><a href=""></a>        messages<span class="op">=</span>[{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: prompt}], </span>
<span id="cb19-5"><a href=""></a>        temperature<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb19-6"><a href=""></a>        seed<span class="op">=</span><span class="dv">42</span></span>
<span id="cb19-7"><a href=""></a>    )</span>
<span id="cb19-8"><a href=""></a>    <span class="cf">return</span> response[<span class="st">"choices"</span>][<span class="dv">0</span>][<span class="st">"message"</span>][<span class="st">"content"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="retrieval-augmented-generation-rag-4" class="title-slide slide level2 center">
<h2>Retrieval Augmented Generation (RAG)</h2>
<div id="6a18ff4d-ce70-4998-aa94-63730b494ef5" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:13.067265Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:13.067067Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:16.411224Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:16.409971Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:13.067245Z&quot;}" data-execution_count="20">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href=""></a>query <span class="op">=</span> <span class="st">"""Which song is about a guy who is so badly wounded in war</span></span>
<span id="cb20-2"><a href=""></a><span class="st">so he no longer has any senses?"""</span></span>
<span id="cb20-3"><a href=""></a><span class="bu">print</span>(generate_response(query))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The song that is about a guy who is so badly wounded in war that he no longer has any senses is "And Justice For All..: One". The lyrics mention "I'm waking up, I cannot see / That there's not much left of me / Nothing is real but pain now / Hold my breath as I wish for death". This suggests the person has lost his sight, speech, hearing, arms, legs and soul due to war wounds.</code></pre>
</div>
</div>
</section>

<section id="retrieval-augmented-generation-rag-5" class="title-slide slide level2 center">
<h2>Retrieval Augmented Generation (RAG)</h2>
<div id="18babdf4-80b5-4b91-b854-c4cf37c86a10" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:16.419742Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:16.419191Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:20.139179Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:20.138500Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:16.419698Z&quot;}" data-execution_count="21">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href=""></a>query <span class="op">=</span> <span class="st">"Which song is about a boy who is having nightmares?"</span></span>
<span id="cb22-2"><a href=""></a><span class="bu">print</span>(generate_response(query))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The song that is about a boy who is having nightmares is "The Black Album: Enter Sandman". The lyrics mention "Say your prayers little one", "tuck you in warm within", "keep you free from sin till the sandman he comes", "dreams of war", "dreams of liars", "dreams of dragon's fire", and "sleep with one eye open gripping your pillow tight". These lines suggest that the song is about a child having nightmares and being afraid of the dark.</code></pre>
</div>
</div>
</section>

<section id="retrieval-augmented-generation-rag-6" class="title-slide slide level2 center">
<h2>Retrieval Augmented Generation (RAG)</h2>
<p><a href="https://alonsosilva-song-finder-bot.hf.space">https://alonsosilva-song-finder-bot.hf.space</a></p>
<div id="123ed860-eb3c-4ee8-9fd0-a3a33b2dcf7a" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:20.139812Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:20.139670Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:20.144154Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:20.143558Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:20.139798Z&quot;}" data-execution_count="22">
<div class="cell-output cell-output-display" data-execution_count="22">

        <iframe width="850" height="450" src="https://alonsosilva-song-finder-bot.hf.space" frameborder="0" allowfullscreen=""></iframe>
        
</div>
</div>
</section>

<section id="retrieval-augmented-generation-rag-7" class="title-slide slide level2 center">
<h2>Retrieval Augmented Generation (RAG)</h2>
<div id="74cfe012-9eaa-426f-89ed-ce35c058714b" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:20.144653Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:20.144530Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:22.234724Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:22.234051Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:20.144640Z&quot;}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href=""></a>query <span class="op">=</span> <span class="st">"How many songs does the black album have?"</span></span>
<span id="cb24-2"><a href=""></a><span class="bu">print</span>(generate_response(query))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Based on the context provided, the Black Album appears to have 5 songs:

1. My Friend Of Misery
2. Nothing Else Matters
3. Don't Tread On Me
4. Sad But True
5. Holier Than Thou</code></pre>
</div>
</div>
</section>

<section id="retrieval-augmented-generation-rag-8" class="title-slide slide level2 center">
<h2>Retrieval Augmented Generation (RAG)</h2>
<div id="e379b242-402d-4698-b111-8b941b7ceb45" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:22.235416Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:22.235273Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:22.241869Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:22.240888Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:22.235403Z&quot;}" data-execution_count="24">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href=""></a>df.<span class="bu">filter</span>(pl.col(<span class="st">"Album"</span>) <span class="op">==</span> <span class="st">"The Black Album"</span>)[<span class="st">"Song"</span>].to_list()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>["Don't Tread On Me",
 'Nothing Else Matters',
 'Through The Never',
 'My Friend Of Misery',
 'Wherever I May Roam',
 'The Unforgiven',
 'The Struggle Within',
 'Of Wolf And Man',
 'The God That Failed',
 'Enter Sandman',
 'Sad But True',
 'Holier Than Thou']</code></pre>
</div>
</div>
</section>
</section>
<section>
<section id="graph-only-retrieval" class="title-slide slide level1 center">
<h1>Graph-only retrieval</h1>

</section>
<section id="graph-only-retrieval-1" class="title-slide slide level2 center">
<h2>Graph-only retrieval</h2>
<div id="5d4378cb-df11-4c71-8ab3-c315cf10ae13" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:22.243654Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:22.242995Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:22.405981Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:22.404726Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:22.243611Z&quot;}" data-execution_count="25">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href=""></a><span class="co"># Initialize graph database</span></span>
<span id="cb28-2"><a href=""></a><span class="im">import</span> shutil</span>
<span id="cb28-3"><a href=""></a><span class="im">import</span> kuzu</span>
<span id="cb28-4"><a href=""></a></span>
<span id="cb28-5"><a href=""></a>shutil.rmtree(<span class="st">"kuzudb_explorer"</span>, ignore_errors<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-6"><a href=""></a>db <span class="op">=</span> kuzu.Database(<span class="st">"kuzudb_explorer"</span>)</span>
<span id="cb28-7"><a href=""></a>conn <span class="op">=</span> kuzu.Connection(db)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="graph-only-retrieval-2" class="title-slide slide level2 center">
<h2>Graph-only retrieval</h2>
<div id="ccffbbae-952e-442a-9474-738fabf01f6b" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:22.406982Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:22.406824Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:22.471305Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:22.470095Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:22.406966Z&quot;}" data-execution_count="26">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href=""></a><span class="co"># Create schema</span></span>
<span id="cb29-2"><a href=""></a>conn.execute(<span class="st">"CREATE NODE TABLE ARTIST(name STRING, PRIMARY KEY (name))"</span>)</span>
<span id="cb29-3"><a href=""></a>conn.execute(<span class="st">"CREATE NODE TABLE ALBUM(name STRING, PRIMARY KEY (name))"</span>)</span>
<span id="cb29-4"><a href=""></a>conn.execute(<span class="st">"CREATE NODE TABLE SONG(ID SERIAL, name STRING, lyrics STRING, PRIMARY KEY(ID))"</span>)</span>
<span id="cb29-5"><a href=""></a>conn.execute(<span class="st">"CREATE REL TABLE IN_ALBUM(FROM SONG TO ALBUM)"</span>)</span>
<span id="cb29-6"><a href=""></a>conn.execute(<span class="st">"CREATE REL TABLE FROM_ARTIST(FROM ALBUM TO ARTIST)"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="graph-only-retrieval-3" class="slide level3">
<h3>Graph-only retrieval</h3>
<div id="475cdbaf-1a22-4c76-ae12-7887e8befeb5" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:22.473087Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:22.472616Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:23.642868Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:23.641432Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:22.473023Z&quot;}" data-execution_count="27">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href=""></a><span class="co"># Insert nodes</span></span>
<span id="cb30-2"><a href=""></a><span class="cf">for</span> artist <span class="kw">in</span> df[<span class="st">"Artist"</span>].unique():</span>
<span id="cb30-3"><a href=""></a>    conn.execute(<span class="ss">f"CREATE (artist:ARTIST </span><span class="ch">{{</span><span class="ss">name: '</span><span class="sc">{</span>artist<span class="sc">}</span><span class="ss">'</span><span class="ch">}}</span><span class="ss">)"</span>)</span>
<span id="cb30-4"><a href=""></a></span>
<span id="cb30-5"><a href=""></a><span class="cf">for</span> album <span class="kw">in</span> df[<span class="st">"Album"</span>].unique():</span>
<span id="cb30-6"><a href=""></a>    conn.execute(<span class="ss">f"""CREATE (album:ALBUM </span><span class="ch">{{</span><span class="ss">name: "</span><span class="sc">{</span>album<span class="sc">}</span><span class="ss">"</span><span class="ch">}}</span><span class="ss">)"""</span>)</span>
<span id="cb30-7"><a href=""></a></span>
<span id="cb30-8"><a href=""></a><span class="cf">for</span> song, lyrics <span class="kw">in</span> df.select([<span class="st">"Song"</span>, <span class="st">"text"</span>]).unique().rows():</span>
<span id="cb30-9"><a href=""></a>    replaced_lyrics <span class="op">=</span> lyrics.replace(<span class="st">'"'</span>, <span class="st">"'"</span>)</span>
<span id="cb30-10"><a href=""></a>    conn.execute(</span>
<span id="cb30-11"><a href=""></a>        <span class="ss">f"""CREATE (song:SONG </span><span class="ch">{{</span><span class="ss">name: "</span><span class="sc">{</span>song<span class="sc">}</span><span class="ss">", lyrics: "</span><span class="sc">{</span>replaced_lyrics<span class="sc">}</span><span class="ss">"</span><span class="ch">}}</span><span class="ss">)"""</span></span>
<span id="cb30-12"><a href=""></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="graph-only-retrieval-4" class="slide level3">
<h3>Graph-only retrieval</h3>
<div id="caea1e10-54da-4dc3-86a7-47e518712b91" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:23.644937Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:23.644312Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:25.321873Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:25.320511Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:23.644890Z&quot;}" data-execution_count="28">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href=""></a><span class="co"># Insert edges</span></span>
<span id="cb31-2"><a href=""></a><span class="cf">for</span> song, album, lyrics <span class="kw">in</span> df.select([<span class="st">"Song"</span>, <span class="st">"Album"</span>, <span class="st">"text"</span>]).rows():</span>
<span id="cb31-3"><a href=""></a>    replaced_lyrics <span class="op">=</span> lyrics.replace(<span class="st">'"'</span>, <span class="st">"'"</span>)</span>
<span id="cb31-4"><a href=""></a>    conn.execute(</span>
<span id="cb31-5"><a href=""></a>        <span class="ss">f"""</span></span>
<span id="cb31-6"><a href=""></a><span class="ss">        MATCH (song:SONG), (album:ALBUM) </span></span>
<span id="cb31-7"><a href=""></a><span class="ss">        WHERE song.name = "</span><span class="sc">{</span>song<span class="sc">}</span><span class="ss">" AND song.lyrics = "</span><span class="sc">{</span>replaced_lyrics<span class="sc">}</span><span class="ss">" AND album.name = "</span><span class="sc">{</span>album<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb31-8"><a href=""></a><span class="ss">        CREATE (song)-[:IN_ALBUM]-&gt;(album)</span></span>
<span id="cb31-9"><a href=""></a><span class="ss">        """</span></span>
<span id="cb31-10"><a href=""></a>    )</span>
<span id="cb31-11"><a href=""></a><span class="cf">for</span> album, artist <span class="kw">in</span> df.select([<span class="st">"Album"</span>, <span class="st">"Artist"</span>]).unique().rows():</span>
<span id="cb31-12"><a href=""></a>  conn.execute(</span>
<span id="cb31-13"><a href=""></a>    <span class="ss">f"""</span></span>
<span id="cb31-14"><a href=""></a><span class="ss">    MATCH (album:ALBUM), (artist:ARTIST) WHERE album.name = "</span><span class="sc">{</span>album<span class="sc">}</span><span class="ss">" AND artist.name = "</span><span class="sc">{</span>artist<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb31-15"><a href=""></a><span class="ss">    CREATE (album)-[:FROM_ARTIST]-&gt;(artist)</span></span>
<span id="cb31-16"><a href=""></a><span class="ss">    """</span></span>
<span id="cb31-17"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="graph-only-retrieval-5" class="slide level3">
<h3>Graph-only retrieval</h3>
<div id="84e62bb3-2d7b-4604-8d8a-299f321a71e4" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:25.323660Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:25.323204Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:25.344953Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:25.343658Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:25.323613Z&quot;}" data-execution_count="29">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href=""></a>response <span class="op">=</span> conn.execute(</span>
<span id="cb32-2"><a href=""></a>    <span class="st">"""</span></span>
<span id="cb32-3"><a href=""></a><span class="st">    MATCH (a:ALBUM {name: 'The Black Album'})&lt;-[:IN_ALBUM]-(s:SONG) </span></span>
<span id="cb32-4"><a href=""></a><span class="st">    RETURN s.name</span></span>
<span id="cb32-5"><a href=""></a><span class="st">    """</span></span>
<span id="cb32-6"><a href=""></a>)</span>
<span id="cb32-7"><a href=""></a></span>
<span id="cb32-8"><a href=""></a>df_response <span class="op">=</span> response.get_as_pl()</span>
<span id="cb32-9"><a href=""></a></span>
<span id="cb32-10"><a href=""></a>df_response[<span class="st">"s.name"</span>].to_list()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>['Wherever I May Roam',
 'The Unforgiven',
 'Enter Sandman',
 'Nothing Else Matters',
 'Sad But True',
 'The Struggle Within',
 "Don't Tread On Me",
 'Through The Never',
 'My Friend Of Misery',
 'Holier Than Thou',
 'Of Wolf And Man',
 'The God That Failed']</code></pre>
</div>
</div>
</section>
<section id="graph-only-retrieval-6" class="slide level3">
<h3>Graph-only retrieval</h3>
<div id="aded8647-e597-4a59-bb53-6cb21acd7104" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:25.346624Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:25.346187Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:25.375631Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:25.374439Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:25.346579Z&quot;}" data-execution_count="30">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href=""></a><span class="im">from</span> langchain_community.graphs <span class="im">import</span> KuzuGraph</span>
<span id="cb34-2"><a href=""></a></span>
<span id="cb34-3"><a href=""></a>graph <span class="op">=</span> KuzuGraph(db)</span>
<span id="cb34-4"><a href=""></a><span class="bu">print</span>(graph.get_schema)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Node properties: [{'properties': [('name', 'STRING')], 'label': 'ARTIST'}, {'properties': [('name', 'STRING')], 'label': 'ALBUM'}, {'properties': [('ID', 'SERIAL'), ('name', 'STRING'), ('lyrics', 'STRING')], 'label': 'SONG'}]
Relationships properties: [{'properties': [], 'label': 'FROM_ARTIST'}, {'properties': [], 'label': 'IN_ALBUM'}]
Relationships: ['(:ALBUM)-[:FROM_ARTIST]-&gt;(:ARTIST)', '(:SONG)-[:IN_ALBUM]-&gt;(:ALBUM)']
</code></pre>
</div>
</div>
</section>

<section id="graph-only-retrieval-7" class="title-slide slide level2 center">
<h2>Graph-only retrieval</h2>
<div id="b2aa0ca5-447c-45c1-b3f6-40237e4bf95d" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:25.377240Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:25.376757Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:25.383853Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:25.382551Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:25.377202Z&quot;}" data-execution_count="31">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href=""></a><span class="kw">def</span> generate_kuzu_prompt(user_query):</span>
<span id="cb36-2"><a href=""></a>    <span class="cf">return</span> <span class="st">"""Task: Generate Kùzu Cypher statement to query a graph database.</span></span>
<span id="cb36-3"><a href=""></a></span>
<span id="cb36-4"><a href=""></a><span class="st">Instructions:</span></span>
<span id="cb36-5"><a href=""></a><span class="st">Generate the Kùzu dialect of Cypher with the following rules in mind:</span></span>
<span id="cb36-6"><a href=""></a><span class="st">1. Do not omit the relationship pattern. Always use `()-[]-&gt;()` instead of `()-&gt;()`.</span></span>
<span id="cb36-7"><a href=""></a><span class="st">2. Do not include triple backticks ``` in your response. Return only Cypher.</span></span>
<span id="cb36-8"><a href=""></a><span class="st">3. Do not return any notes or comments in your response.</span></span>
<span id="cb36-9"><a href=""></a></span>
<span id="cb36-10"><a href=""></a></span>
<span id="cb36-11"><a href=""></a><span class="st">Use only the provided relationship types and properties in the schema.</span></span>
<span id="cb36-12"><a href=""></a><span class="st">Do not use any other relationship types or properties that are not provided.</span></span>
<span id="cb36-13"><a href=""></a><span class="st">Schema:</span><span class="ch">\n</span><span class="st">"""</span> <span class="op">+</span> graph.get_schema <span class="op">+</span> <span class="st">"""</span><span class="ch">\n</span><span class="st">Example:</span></span>
<span id="cb36-14"><a href=""></a><span class="st">The question is:</span><span class="ch">\n</span><span class="st">"Which songs does the load album have?"</span></span>
<span id="cb36-15"><a href=""></a><span class="st">MATCH (a:ALBUM {name: 'Load'})&lt;-[:IN_ALBUM]-(s:SONG) RETURN s.name</span></span>
<span id="cb36-16"><a href=""></a></span>
<span id="cb36-17"><a href=""></a><span class="st">Note: Do not include any explanations or apologies in your responses.</span></span>
<span id="cb36-18"><a href=""></a><span class="st">Do not respond to any questions that might ask anything else than for you to construct a Cypher statement.</span></span>
<span id="cb36-19"><a href=""></a><span class="st">Do not include any text except the generated Cypher statement.</span></span>
<span id="cb36-20"><a href=""></a></span>
<span id="cb36-21"><a href=""></a><span class="st">The question is:</span><span class="ch">\n</span><span class="st">"""</span> <span class="op">+</span> user_query</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="graph-only-retrieval-8" class="title-slide slide level2 center">
<h2>Graph-only retrieval</h2>
<div id="43620885-f376-4fd2-aaa5-03daf91e0c67" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:25.385648Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:25.385194Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:25.397090Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:25.395935Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:25.385602Z&quot;}" data-execution_count="32">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href=""></a><span class="kw">def</span> generate_final_prompt(query,cypher_query,col_name,_values):</span>
<span id="cb37-2"><a href=""></a>    <span class="cf">return</span> <span class="ss">f"""You are an assistant that helps to form nice and human understandable answers.</span></span>
<span id="cb37-3"><a href=""></a><span class="ss">The information part contains the provided information that you must use to construct an answer.</span></span>
<span id="cb37-4"><a href=""></a><span class="ss">The provided information is authoritative, you must never doubt it or try to use your internal knowledge to correct it.</span></span>
<span id="cb37-5"><a href=""></a><span class="ss">Make the answer sound as a response to the question. Do not mention that you based the result on the given information.</span></span>
<span id="cb37-6"><a href=""></a><span class="ss">Here is an example:</span></span>
<span id="cb37-7"><a href=""></a></span>
<span id="cb37-8"><a href=""></a><span class="ss">Question: Which managers own Neo4j stocks?</span></span>
<span id="cb37-9"><a href=""></a><span class="ss">Context:[manager:CTL LLC, manager:JANE STREET GROUP LLC]</span></span>
<span id="cb37-10"><a href=""></a><span class="ss">Helpful Answer: CTL LLC, JANE STREET GROUP LLC owns Neo4j stocks.</span></span>
<span id="cb37-11"><a href=""></a></span>
<span id="cb37-12"><a href=""></a><span class="ss">Follow this example when generating answers.</span></span>
<span id="cb37-13"><a href=""></a><span class="ss">If the provided information is empty, say that you don't know the answer.</span></span>
<span id="cb37-14"><a href=""></a><span class="ss">Query:</span><span class="ch">\n</span><span class="sc">{</span>cypher_query<span class="sc">}</span></span>
<span id="cb37-15"><a href=""></a><span class="ss">Information:</span></span>
<span id="cb37-16"><a href=""></a><span class="ss">[</span><span class="sc">{</span>col_name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>_values<span class="sc">}</span><span class="ss">]</span></span>
<span id="cb37-17"><a href=""></a></span>
<span id="cb37-18"><a href=""></a><span class="ss">Question: </span><span class="sc">{</span>query<span class="sc">}</span></span>
<span id="cb37-19"><a href=""></a><span class="ss">Helpful Answer:</span></span>
<span id="cb37-20"><a href=""></a><span class="ss">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="graph-only-retrieval-9" class="title-slide slide level2 center">
<h2>Graph-only retrieval</h2>
<div id="e5e686ff-979a-438a-bdce-b2b34079adeb" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:25.399195Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:25.398545Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:25.416135Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:25.414793Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:25.399147Z&quot;}" data-execution_count="33">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href=""></a><span class="kw">def</span> generate_kg_response(query):</span>
<span id="cb38-2"><a href=""></a>    prompt <span class="op">=</span> generate_kuzu_prompt(query)</span>
<span id="cb38-3"><a href=""></a>    cypher_query_response <span class="op">=</span> llm.create_chat_completion(</span>
<span id="cb38-4"><a href=""></a>        messages<span class="op">=</span>[{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: prompt}], </span>
<span id="cb38-5"><a href=""></a>        temperature<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb38-6"><a href=""></a>        seed<span class="op">=</span><span class="dv">42</span></span>
<span id="cb38-7"><a href=""></a>    )</span>
<span id="cb38-8"><a href=""></a>    cypher_query <span class="op">=</span> cypher_query_response[<span class="st">"choices"</span>][<span class="dv">0</span>][<span class="st">"message"</span>][<span class="st">"content"</span>]</span>
<span id="cb38-9"><a href=""></a>    response <span class="op">=</span> conn.execute(</span>
<span id="cb38-10"><a href=""></a>        <span class="ss">f"""</span></span>
<span id="cb38-11"><a href=""></a><span class="ss">        </span><span class="sc">{</span>cypher_query<span class="sc">}</span></span>
<span id="cb38-12"><a href=""></a><span class="ss">        """</span></span>
<span id="cb38-13"><a href=""></a>    )</span>
<span id="cb38-14"><a href=""></a>    df <span class="op">=</span> response.get_as_pl()</span>
<span id="cb38-15"><a href=""></a>    col_name <span class="op">=</span> df.columns[<span class="dv">0</span>]</span>
<span id="cb38-16"><a href=""></a>    _values <span class="op">=</span> df[col_name].to_list()</span>
<span id="cb38-17"><a href=""></a>    final_prompt <span class="op">=</span> generate_final_prompt(query,cypher_query,col_name,_values)</span>
<span id="cb38-18"><a href=""></a>    final_response <span class="op">=</span> llm.create_chat_completion(</span>
<span id="cb38-19"><a href=""></a>        messages<span class="op">=</span>[{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: final_prompt}], </span>
<span id="cb38-20"><a href=""></a>        temperature<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb38-21"><a href=""></a>        seed<span class="op">=</span><span class="dv">42</span></span>
<span id="cb38-22"><a href=""></a>    )</span>
<span id="cb38-23"><a href=""></a>    <span class="cf">return</span> final_response[<span class="st">"choices"</span>][<span class="dv">0</span>][<span class="st">"message"</span>][<span class="st">"content"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="graph-only-retrieval-10" class="title-slide slide level2 center">
<h2>Graph-only retrieval</h2>
<div id="f3cb2ad1-9a50-4ce0-beff-8aa872593480" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:25.418017Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:25.417543Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:26.544160Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:26.542873Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:25.417970Z&quot;}" data-execution_count="34">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href=""></a>query <span class="op">=</span> <span class="st">"How many songs does the black album have?"</span></span>
<span id="cb39-2"><a href=""></a><span class="bu">print</span>(generate_kg_response(query))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The Black Album has 12 songs.</code></pre>
</div>
</div>
</section>

<section id="graph-only-retrieval-11" class="title-slide slide level2 center">
<h2>Graph-only retrieval</h2>
<div id="cc15fa19-985a-4f11-876d-941f58b03e87" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:26.546116Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:26.545350Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:29.043835Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:29.042555Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:26.546071Z&quot;}" data-execution_count="35">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href=""></a>query <span class="op">=</span> <span class="st">"Which songs does the black album have?"</span></span>
<span id="cb41-2"><a href=""></a><span class="bu">print</span>(generate_kg_response(query))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The Black Album has the following songs: Wherever I May Roam, The Unforgiven, Enter Sandman, Nothing Else Matters, Sad But True, The Struggle Within, "Don't Tread On Me", Through The Never, My Friend Of Misery, Holier Than Thou, Of Wolf And Man, and The God That Failed.</code></pre>
</div>
</div>
</section>

<section id="graph-only-retrieval-12" class="title-slide slide level2 center">
<h2>Graph-only retrieval</h2>
<p><a href="https://alonsosilva-song-finder-graph.hf.space">https://alonsosilva-song-finder-graph.hf.space</a></p>
<div id="cc688384-b9b7-45ca-8e9c-663e114ec317" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:29.044880Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:29.044717Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:29.049152Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:29.048551Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:29.044865Z&quot;}" data-execution_count="36">
<div class="cell-output cell-output-display" data-execution_count="36">

        <iframe width="850" height="450" src="https://alonsosilva-song-finder-graph.hf.space" frameborder="0" allowfullscreen=""></iframe>
        
</div>
</div>
</section>
</section>
<section>
<section id="combining-graph-and-vector-retrieval" class="title-slide slide level1 center">
<h1>Combining graph and vector retrieval</h1>

</section>
<section id="classification" class="title-slide slide level2 center">
<h2>Classification</h2>
<div id="6ab96c2d-8a5f-4d63-a5c5-fe0f7c8241a0" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:29.049809Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:29.049674Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:29.069670Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:29.068481Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:29.049796Z&quot;}" data-execution_count="37">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href=""></a><span class="kw">def</span> generate_hermes_prompt(user_prompt):</span>
<span id="cb43-2"><a href=""></a>    <span class="cf">return</span> (</span>
<span id="cb43-3"><a href=""></a>        <span class="st">"&lt;|im_start|&gt;system</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb43-4"><a href=""></a>        <span class="st">"You are a world class AI model classifier"</span></span>
<span id="cb43-5"><a href=""></a>        <span class="st">"&lt;|im_end|&gt;</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb43-6"><a href=""></a>        <span class="st">"&lt;|im_start|&gt;user</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb43-7"><a href=""></a>        <span class="op">+</span> user_prompt</span>
<span id="cb43-8"><a href=""></a>        <span class="op">+</span> <span class="st">"&lt;|im_end|&gt;"</span></span>
<span id="cb43-9"><a href=""></a>        <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">&lt;|im_start|&gt;assistant</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb43-10"><a href=""></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="classification-1" class="title-slide slide level2 center">
<h2>Classification</h2>
<div id="89ff3d51-9309-44a5-a065-cd0741134b6f" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:29.071341Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:29.070824Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:29.572842Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:29.571562Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:29.071296Z&quot;}" data-execution_count="38">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href=""></a><span class="im">from</span> outlines <span class="im">import</span> generate, models</span>
<span id="cb44-2"><a href=""></a><span class="im">from</span> outlines.samplers <span class="im">import</span> greedy</span>
<span id="cb44-3"><a href=""></a></span>
<span id="cb44-4"><a href=""></a><span class="kw">def</span> get_classification(query):</span>
<span id="cb44-5"><a href=""></a>    model <span class="op">=</span> models.LlamaCpp(llm)</span>
<span id="cb44-6"><a href=""></a>    generator <span class="op">=</span> generate.choice(model, [<span class="st">"YES"</span>, <span class="st">"NO"</span>], sampler<span class="op">=</span>greedy())</span>
<span id="cb44-7"><a href=""></a>    prompt <span class="op">=</span> <span class="st">"Answer only YES or NO. Is the question '"</span> <span class="op">+</span> query <span class="op">+</span> <span class="op">\</span></span>
<span id="cb44-8"><a href=""></a>             <span class="st">"' related to the content of a song?"</span></span>
<span id="cb44-9"><a href=""></a>    prompt <span class="op">=</span> generate_hermes_prompt(prompt)</span>
<span id="cb44-10"><a href=""></a>    response <span class="op">=</span> generator(prompt, max_tokens<span class="op">=</span><span class="dv">1024</span>, temperature<span class="op">=</span><span class="dv">0</span>, seed<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb44-11"><a href=""></a>    <span class="cf">return</span> response</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="classification-2" class="title-slide slide level2 center">
<h2>Classification</h2>
<div id="c835c593-03b4-493c-ad08-a341aa944098" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:29.573609Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:29.573466Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:30.462949Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:30.462453Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:29.573596Z&quot;}" data-execution_count="39">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href=""></a>queries <span class="op">=</span> [</span>
<span id="cb45-2"><a href=""></a>    <span class="st">"Which song is about a boy who is having nightmares?"</span>,</span>
<span id="cb45-3"><a href=""></a>    <span class="st">"Which song is about a guy who is so badly wounded in war so he no longer has any senses?"</span>,</span>
<span id="cb45-4"><a href=""></a>    <span class="st">"How many songs does the black album have?"</span>,</span>
<span id="cb45-5"><a href=""></a>    <span class="st">"Which songs does the black album have?"</span></span>
<span id="cb45-6"><a href=""></a>]</span>
<span id="cb45-7"><a href=""></a><span class="cf">for</span> query <span class="kw">in</span> queries:</span>
<span id="cb45-8"><a href=""></a>    <span class="bu">print</span>(<span class="ss">f"**</span><span class="sc">{</span>query<span class="sc">}</span><span class="ss">**"</span>)</span>
<span id="cb45-9"><a href=""></a>    <span class="bu">print</span>(get_classification(query))</span>
<span id="cb45-10"><a href=""></a>    <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>**Which song is about a boy who is having nightmares?**
YES

**Which song is about a guy who is so badly wounded in war so he no longer has any senses?**
YES

**How many songs does the black album have?**
NO

**Which songs does the black album have?**
NO
</code></pre>
</div>
</div>
</section>

<section id="combining-graph-and-vector-retrieval-1" class="title-slide slide level2 center">
<h2>Combining graph and vector retrieval</h2>
<div id="58887490-7ae4-4620-ad43-a497c1587b34" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:30.489358Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:30.488502Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:30.499795Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:30.498650Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:30.489315Z&quot;}" data-execution_count="42">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href=""></a><span class="kw">def</span> get_final_response(query):</span>
<span id="cb47-2"><a href=""></a>    query_class <span class="op">=</span> get_classification(query)</span>
<span id="cb47-3"><a href=""></a>    <span class="cf">if</span> query_class <span class="op">==</span> <span class="st">'YES'</span>:</span>
<span id="cb47-4"><a href=""></a>        response <span class="op">=</span> generate_response(query)</span>
<span id="cb47-5"><a href=""></a>    <span class="cf">else</span>:</span>
<span id="cb47-6"><a href=""></a>        response <span class="op">=</span> generate_kg_response(query)</span>
<span id="cb47-7"><a href=""></a>    <span class="cf">return</span> response</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="combining-graph-and-vector-retrieval-2" class="title-slide slide level2 center">
<h2>Combining graph and vector retrieval</h2>
<div id="2803f581-06e1-44c2-9369-4ff506ce090a" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:30.501420Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:30.500921Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:41.589918Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:41.589028Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:30.501379Z&quot;}" data-execution_count="43">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href=""></a>queries <span class="op">=</span> [</span>
<span id="cb48-2"><a href=""></a>    <span class="st">"Which song is about a boy who is having nightmares?"</span>,</span>
<span id="cb48-3"><a href=""></a>    <span class="st">"Which song is about a guy who is so badly wounded in war so he no longer has any senses"</span>,</span>
<span id="cb48-4"><a href=""></a>    <span class="st">"How many songs does the black album have?"</span>,</span>
<span id="cb48-5"><a href=""></a>    <span class="st">"Which songs does the black album have?"</span></span>
<span id="cb48-6"><a href=""></a>]</span>
<span id="cb48-7"><a href=""></a><span class="cf">for</span> query <span class="kw">in</span> queries:</span>
<span id="cb48-8"><a href=""></a>    <span class="bu">print</span>(<span class="ss">f"**</span><span class="sc">{</span>query<span class="sc">}</span><span class="ss">**"</span>)</span>
<span id="cb48-9"><a href=""></a>    <span class="bu">print</span>(get_final_response(query))</span>
<span id="cb48-10"><a href=""></a>    <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>**Which song is about a boy who is having nightmares?**
The song that is about a boy who is having nightmares is "The Black Album: Enter Sandman". The lyrics mention "Say your prayers little one", "tuck you in warm within", "keep you free from sin till the sandman he comes", "dreams of war", "dreams of liars", "dreams of dragon's fire", and "sleep with one eye open gripping your pillow tight". These lines suggest that the song is about a child having nightmares and being afraid of the dark.

**Which song is about a guy who is so badly wounded in war so he no longer has any senses**
Based on the context provided, the song "One" from the album "And Justice For All.." is about a guy who is so badly wounded in war that he no longer has any senses. The lyrics describe him waking up unable to see, hear, speak, or move, and being trapped in his body as if it were a prison cell. He wishes for death and feels absolute horror and despair.

**How many songs does the black album have?**
The Black Album has 12 songs.

**Which songs does the black album have?**
The Black Album has the following songs: Wherever I May Roam, The Unforgiven, Enter Sandman, Nothing Else Matters, Sad But True, The Struggle Within, "Don't Tread On Me", Through The Never, My Friend Of Misery, Holier Than Thou, Of Wolf And Man, and The God That Failed.
</code></pre>
</div>
</div>
</section>

<section id="combining-graph-and-vectorial-retrieval" class="title-slide slide level2 center">
<h2>Combining graph and vectorial retrieval</h2>
<p><a href="https://alonsosilva-song-finder-graphrag.hf.space">https://alonsosilva-song-finder-graphrag.hf.space</a></p>
<div id="2420c8f9-2a51-459c-8304-7bf9f9481ccd" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:41.591404Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:41.590920Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:41.598172Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:41.597242Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:41.591361Z&quot;}" data-execution_count="44">
<div class="cell-output cell-output-display" data-execution_count="44">

        <iframe width="850" height="450" src="https://alonsosilva-song-finder-graphrag.hf.space" frameborder="0" allowfullscreen=""></iframe>
        
</div>
</div>
</section>
</section>
<section>
<section id="what-is-structured-generation" class="title-slide slide level1 center">
<h1>What is Structured Generation?</h1>

</section>
<section id="section-1" class="title-slide slide level2 center">
<h2></h2>
<div style="margin-top: 100px; font-size: 2em; color: black;">
<p>The problem</p>
</div>
</section>

<section id="section-2" class="title-slide slide level2 center">
<h2></h2>

<img data-src="./assets/scikit-llm.jpg" title="scikit-llm Homepage" style="width:50.0%" class="r-stretch quarto-figure-center"><p class="caption">scikit-llm: <a href="https://skllm.beastbyte.ai/">https://skllm.beastbyte.ai/</a></p></section>
<section id="show-me-the-prompt" class="slide level3">
<h3>Show me the prompt!</h3>

<img data-src="./assets/scikit-llm-prompt.jpg" title="scikit-llm prompt" style="width:25.0%" class="r-stretch quarto-figure-center"><p class="caption">scikit-llm prompts: <a href="https://github.com/iryna-kondr/scikit-llm/blob/main/skllm/prompts/templates.py">https://github.com/iryna-kondr/scikit-llm/blob/main/skllm/prompts/templates.py</a></p></section>
<section id="section-3" class="slide level3">
<h3></h3>

<img data-src="./assets/we-can-do-better.jpg" title="We can do better!" style="width:50.0%" class="r-stretch"></section>
<section id="section-4" class="slide level3">
<h3></h3>
<div style="margin-top: 200px; font-size: 2em; color: black;">
<p>What is NOT Structured Generation?</p>
</div>
</section>
<section id="structured-outputs-in-the-style-of-instructormarvin-libraries" class="slide level3">
<h3>Structured Outputs (in the style of Instructor/Marvin libraries)</h3>
<ul>
<li>Instructor: <a href="https://python.useinstructor.com/">https://python.useinstructor.com/</a></li>
<li>Marvin: <a href="https://www.askmarvin.ai/">https://www.askmarvin.ai/</a></li>
</ul>
</section>
<section id="structured-outputs-in-code" class="slide level3">
<h3>Structured Outputs in Code</h3>
<div id="f9b433ce-757a-486d-b594-b2f0305bb95f" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:41.599640Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:41.599246Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:43.473791Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:43.472964Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:41.599601Z&quot;}" data-scrolled="true" data-execution_count="45">
<div class="sourceCode cell-code" id="annotated-cell-35"><pre class="sourceCode numberSource python code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-35-1"><a href="#annotated-cell-35-1"></a><span class="im">import</span> llama_cpp  </span>
<span id="annotated-cell-35-2"><a href="#annotated-cell-35-2"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-35" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-35-3" class="code-annotation-target"><a href="#annotated-cell-35-3"></a>model_id <span class="op">=</span> <span class="st">"NousResearch/Hermes-3-Llama-3.1-8B"</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-35" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-35-4" class="code-annotation-target"><a href="#annotated-cell-35-4"></a>llm <span class="op">=</span> llama_cpp.Llama(</span>
<span id="annotated-cell-35-5"><a href="#annotated-cell-35-5"></a>    <span class="st">"/big_storage/llms/models/Hermes-3-Llama-3.1-8B.Q6_K.gguf"</span>,</span>
<span id="annotated-cell-35-6"><a href="#annotated-cell-35-6"></a>    tokenizer<span class="op">=</span>llama_cpp.llama_tokenizer.LlamaHFTokenizer.from_pretrained(</span>
<span id="annotated-cell-35-7"><a href="#annotated-cell-35-7"></a>        model_id</span>
<span id="annotated-cell-35-8"><a href="#annotated-cell-35-8"></a>    ),</span>
<span id="annotated-cell-35-9"><a href="#annotated-cell-35-9"></a>    n_gpu_layers<span class="op">=-</span><span class="dv">1</span>,</span>
<span id="annotated-cell-35-10"><a href="#annotated-cell-35-10"></a>    flash_attn<span class="op">=</span><span class="va">True</span>,</span>
<span id="annotated-cell-35-11"><a href="#annotated-cell-35-11"></a>    n_ctx<span class="op">=</span><span class="dv">8192</span>,</span>
<span id="annotated-cell-35-12"><a href="#annotated-cell-35-12"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="annotated-cell-35-13"><a href="#annotated-cell-35-13"></a>    chat_format<span class="op">=</span><span class="st">"chatml-function-calling"</span></span>
<span id="annotated-cell-35-14"><a href="#annotated-cell-35-14"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-35" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-35" data-code-lines="3" data-code-annotation="1"><a href="https://nousresearch.com/hermes3/">Hermes 3</a> by <a href="https://nousresearch.com/">NousResearch</a></span>
</dd>
<dt data-target-cell="annotated-cell-35" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-35" data-code-lines="4" data-code-annotation="2"><a href="https://llama-cpp-python.readthedocs.io/">llama-cpp-python</a> python bindings for <a href="https://github.com/ggerganov/llama.cpp">llama.cpp</a></span>
</dd>
</dl>
</div>
</div>
</section>
<section id="structured-outputs-in-code-1" class="slide level3">
<h3>Structured Outputs in Code</h3>
<div id="d0884357-5b48-441b-8da5-102f201a46f6" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:43.475367Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:43.474844Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:43.482212Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:43.481245Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:43.475325Z&quot;}" data-execution_count="46">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href=""></a><span class="im">from</span> typing <span class="im">import</span> Literal</span>
<span id="cb50-2"><a href=""></a></span>
<span id="cb50-3"><a href=""></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel, Field</span>
<span id="cb50-4"><a href=""></a></span>
<span id="cb50-5"><a href=""></a></span>
<span id="cb50-6"><a href=""></a><span class="kw">class</span> Sentiment(BaseModel):</span>
<span id="cb50-7"><a href=""></a>    <span class="co">"""Correctly inferred `Sentiment` with all the required parameters</span></span>
<span id="cb50-8"><a href=""></a><span class="co">    with correct types."""</span></span>
<span id="cb50-9"><a href=""></a></span>
<span id="cb50-10"><a href=""></a>    label: Literal[<span class="st">"Positive"</span>, <span class="st">"Negative"</span>] <span class="op">=</span> Field(</span>
<span id="cb50-11"><a href=""></a>        ..., description<span class="op">=</span><span class="st">"Sentiment of the text"</span></span>
<span id="cb50-12"><a href=""></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="structured-outputs-in-code-2" class="slide level3">
<h3>Structured Outputs in Code</h3>
<div id="2af4f0b6-969b-4c07-9b88-dbddf61d7cd3" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:43.483703Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:43.483201Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:43.959761Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:43.959108Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:43.483662Z&quot;}" data-execution_count="47">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href=""></a><span class="im">from</span> langchain_core.utils.function_calling <span class="im">import</span> convert_to_openai_tool</span>
<span id="cb51-2"><a href=""></a></span>
<span id="cb51-3"><a href=""></a>tools <span class="op">=</span> [convert_to_openai_tool(Sentiment)]</span>
<span id="cb51-4"><a href=""></a>tools</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>[{'type': 'function',
  'function': {'name': 'Sentiment',
   'description': 'Correctly inferred `Sentiment` with all the required parameters\nwith correct types.',
   'parameters': {'properties': {'label': {'description': 'Sentiment of the text',
      'enum': ['Positive', 'Negative'],
      'type': 'string'}},
    'required': ['label'],
    'type': 'object'}}}]</code></pre>
</div>
</div>
</section>
<section id="structured-outputs-in-code-3" class="slide level3">
<h3>Structured Outputs in Code</h3>
<div id="97c17363-4e29-4e55-a99d-0f07a00081b9" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:43.963457Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:43.963327Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:44.333279Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:44.332812Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:43.963444Z&quot;}" data-execution_count="49">
<div class="sourceCode cell-code" id="cb53" data-code-line-numbers="1-17|1|1,8-9|1,8-9,13-14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href=""></a>user_input <span class="op">=</span> <span class="st">"You are great"</span></span>
<span id="cb53-2"><a href=""></a></span>
<span id="cb53-3"><a href=""></a>output <span class="op">=</span> llm.create_chat_completion(</span>
<span id="cb53-4"><a href=""></a>    messages<span class="op">=</span>[</span>
<span id="cb53-5"><a href=""></a>        {</span>
<span id="cb53-6"><a href=""></a>            <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb53-7"><a href=""></a>            <span class="st">"content"</span>: (</span>
<span id="cb53-8"><a href=""></a>                <span class="st">"What is the sentiment conveyed in the following text: "</span></span>
<span id="cb53-9"><a href=""></a>                <span class="ss">f"</span><span class="sc">{</span>user_input<span class="sc">}</span><span class="ss">."</span></span>
<span id="cb53-10"><a href=""></a>            ),</span>
<span id="cb53-11"><a href=""></a>        },</span>
<span id="cb53-12"><a href=""></a>    ],</span>
<span id="cb53-13"><a href=""></a>    tools<span class="op">=</span>tools,</span>
<span id="cb53-14"><a href=""></a>    tool_choice<span class="op">=</span>{<span class="st">"type"</span>: <span class="st">"function"</span>, <span class="st">"function"</span>: {<span class="st">"name"</span>: <span class="st">"Sentiment"</span>}},</span>
<span id="cb53-15"><a href=""></a>)</span>
<span id="cb53-16"><a href=""></a></span>
<span id="cb53-17"><a href=""></a>output[<span class="st">"choices"</span>][<span class="dv">0</span>][<span class="st">"message"</span>][<span class="st">"tool_calls"</span>][<span class="dv">0</span>][<span class="st">"function"</span>][<span class="st">"arguments"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>'{ "label": "Positive"}'</code></pre>
</div>
</div>
</section>

<section id="section-5" class="title-slide slide level2 center">
<h2></h2>

<img data-src="./assets/we-can-do-better.jpg" title="We can do better!" style="width:50.0%" class="r-stretch"></section>
<section id="section-6" class="slide level3">
<h3></h3>
<div style="margin-top: 200px; font-size: 2em; color: black;">
<p>What is Structured Generation?</p>
</div>
</section>
<section id="section-7" class="slide level3 nostretch">
<h3></h3>
<p><img data-src="./assets/outlines-logo.webp" title="Outlines logo" style="width:40.0%"></p>
<p><a href="https://dottxt-ai.github.io/outlines/">https://dottxt-ai.github.io/outlines/</a></p>
</section>
<section id="observation-llms-are-samplers" class="slide level3">
<h3>Observation: LLMs are samplers</h3>
<p><a href="https://alonsosilva-nexttokenprediction.hf.space">https://alonsosilva-nexttokenprediction.hf.space</a></p>
<div id="12fba708-bb3f-4c4a-b092-c946523335a8" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:44.333935Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:44.333779Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:44.337163Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:44.336793Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:44.333921Z&quot;}" data-execution_count="50">
<div class="cell-output cell-output-display" data-execution_count="50">

        <iframe width="950" height="450" src="https://alonsosilva-nexttokenprediction.hf.space" frameborder="0" allowfullscreen=""></iframe>
        
</div>
</div>
</section>
<section id="we-need-to-talk-about-regular-expressions-regex" class="slide level3">
<h3>We need to talk about Regular Expressions (regex)</h3>

<img data-src="./assets/torture-regex.jpg" title="Let the torture commence meme" style="width:50.0%" class="r-stretch"></section>
<section id="regular-expression-regex" class="slide level3">
<h3>Regular Expression (regex)</h3>

<img data-src="./assets/regex_chatgpt.jpg" title="ChatGPT explaining the regex a*b*" style="width:25.0%" class="r-stretch"></section>
<section id="deterministic-finite-automata-dfa" class="slide level3 nostretch">
<h3>Deterministic Finite Automata (DFA)</h3>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="./assets/Structured-Generation-1.jpg" title="Diagrams explaining" class="quarto-figure quarto-figure-center" style="width:50.0%"></p>
</figure>
</div>
<p><a href="https://github.com/vivien000/regex-constrained-decoding">Fast, High-Fidelity LLM Decoding with Regex Constraints</a> by <a href="https://github.com/vivien000">Vivien Tran-Thien</a></p>
</section>
<section id="deterministic-finite-automata-dfa-1" class="slide level3 nostretch">
<h3>Deterministic Finite Automata (DFA)</h3>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="./assets/Structured-Generation-2.jpg" title="Diagrams explaining" class="quarto-figure quarto-figure-center" style="width:50.0%"></p>
</figure>
</div>
<p><a href="https://github.com/vivien000/regex-constrained-decoding">Fast, High-Fidelity LLM Decoding with Regex Constraints</a> by <a href="https://github.com/vivien000">Vivien Tran-Thien</a></p>
</section>
<section id="deterministic-finite-automata-dfa-2" class="slide level3 nostretch">
<h3>Deterministic Finite Automata (DFA)</h3>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="./assets/Structured-Generation-3.jpg" title="Diagrams explaining" class="quarto-figure quarto-figure-center" style="width:60.0%"></p>
</figure>
</div>
<p><a href="https://github.com/vivien000/regex-constrained-decoding">Fast, High-Fidelity LLM Decoding with Regex Constraints</a> by <a href="https://github.com/vivien000">Vivien Tran-Thien</a></p>
</section>
<section id="back-to-the-problem" class="slide level3">
<h3>Back to the problem</h3>

<img data-src="./assets/scikit-llm-prompt.jpg" title="scikit-llm prompt" style="width:25.0%" class="r-stretch quarto-figure-center"><p class="caption">scikit-llm prompts: <a href="https://github.com/iryna-kondr/scikit-llm/blob/main/skllm/prompts/templates.py">https://github.com/iryna-kondr/scikit-llm/blob/main/skllm/prompts/templates.py</a></p></section>
<section id="from-regular-expression-regex-to-deterministic-finite-automata-dfa" class="slide level3">
<h3>From regular expression (regex) to deterministic finite automata (DFA)</h3>
<p>For example, for sentiment analysis:</p>

<img data-src="./assets/fsm-simple.jpg" style="width:25.0%" class="r-stretch"></section>
<section id="life-is-hard" class="slide level3">
<h3>Life is hard</h3>

<img data-src="./assets/fsm-full.jpg" style="width:25.0%" class="r-stretch"></section>
<section id="whats-in-a-label" class="slide level3">
<h3>What’s in a “label”?</h3>

<img data-src="./assets/what-is-in-a-label.jpg" style="width:25.0%" class="r-stretch"></section>
<section id="structured-generation-in-code" class="slide level3">
<h3>Structured Generation in Code</h3>
<div id="95f4eea3-d2eb-4595-a868-defc0c9b052d" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:44.337758Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:44.337596Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:45.044992Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:45.043732Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:44.337745Z&quot;}" data-execution_count="51">
<div class="sourceCode cell-code" id="annotated-cell-39" data-code-line-numbers="1-13|12"><pre class="sourceCode numberSource python code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-39-1"><a href="#annotated-cell-39-1"></a><span class="im">import</span> outlines</span>
<span id="annotated-cell-39-2"><a href="#annotated-cell-39-2"></a></span>
<span id="annotated-cell-39-3"><a href="#annotated-cell-39-3"></a><span class="im">import</span> transformers</span>
<span id="annotated-cell-39-4"><a href="#annotated-cell-39-4"></a></span>
<span id="annotated-cell-39-5"><a href="#annotated-cell-39-5"></a>outlines_tokenizer <span class="op">=</span> outlines.models.TransformerTokenizer(</span>
<span id="annotated-cell-39-6"><a href="#annotated-cell-39-6"></a>    transformers.AutoTokenizer.from_pretrained(model_id)</span>
<span id="annotated-cell-39-7"><a href="#annotated-cell-39-7"></a>)</span>
<span id="annotated-cell-39-8"><a href="#annotated-cell-39-8"></a></span>
<span id="annotated-cell-39-9"><a href="#annotated-cell-39-9"></a>outlines_logits_processor <span class="op">=</span> outlines.processors.JSONLogitsProcessor(</span>
<span id="annotated-cell-39-10"><a href="#annotated-cell-39-10"></a>    Sentiment,</span>
<span id="annotated-cell-39-11"><a href="#annotated-cell-39-11"></a>    outlines_tokenizer,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-39" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-39-12" class="code-annotation-target"><a href="#annotated-cell-39-12"></a>    whitespace_pattern<span class="op">=</span><span class="vs">r"[\n\t ]*"</span></span>
<span id="annotated-cell-39-13"><a href="#annotated-cell-39-13"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-39" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-39" data-code-lines="12" data-code-annotation="1">I like to give the language model some structure but also some leeway.</span>
</dd>
</dl>
</div>
</div>
</section>
<section id="structured-generation-in-code-1" class="slide level3">
<h3>Structured Generation in Code</h3>
<div id="cb79677b-e037-4f30-86ad-ed6f6852a32f" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:45.045816Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:45.045658Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:45.238678Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:45.237947Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:45.045801Z&quot;}" data-execution_count="52">
<div class="sourceCode cell-code" id="cb55" data-code-line-numbers="1-18|1|1,8-9|1,8-9,13-15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href=""></a>user_input <span class="op">=</span> <span class="st">"You are great"</span></span>
<span id="cb55-2"><a href=""></a></span>
<span id="cb55-3"><a href=""></a>output <span class="op">=</span> llm.create_chat_completion(</span>
<span id="cb55-4"><a href=""></a>    messages<span class="op">=</span>[</span>
<span id="cb55-5"><a href=""></a>        {</span>
<span id="cb55-6"><a href=""></a>            <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb55-7"><a href=""></a>            <span class="st">"content"</span>: (</span>
<span id="cb55-8"><a href=""></a>                <span class="st">"What is the sentiment conveyed in the following text: "</span></span>
<span id="cb55-9"><a href=""></a>                <span class="ss">f"</span><span class="sc">{</span>user_input<span class="sc">}</span><span class="ss">."</span></span>
<span id="cb55-10"><a href=""></a>            ),</span>
<span id="cb55-11"><a href=""></a>        },</span>
<span id="cb55-12"><a href=""></a>    ],</span>
<span id="cb55-13"><a href=""></a>    logits_processor<span class="op">=</span>transformers.LogitsProcessorList(</span>
<span id="cb55-14"><a href=""></a>        [outlines_logits_processor]</span>
<span id="cb55-15"><a href=""></a>    ),</span>
<span id="cb55-16"><a href=""></a>)</span>
<span id="cb55-17"><a href=""></a></span>
<span id="cb55-18"><a href=""></a>output[<span class="st">"choices"</span>][<span class="dv">0</span>][<span class="st">"message"</span>][<span class="st">"content"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>'{ "label": "Positive" }'</code></pre>
</div>
</div>
</section>

<section id="structured-outputs-structured-generation" class="title-slide slide level2 center">
<h2>Structured Outputs + Structured Generation</h2>

</section>
<section id="section-8" class="slide level3">
<h3></h3>
<div id="36d9920b-c46a-43ae-b7e6-eb5fa819df2e" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:45.377570Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:45.376876Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:45.769635Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:45.769167Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:45.377517Z&quot;}" data-execution_count="54">
<div class="sourceCode cell-code" id="annotated-cell-41" data-code-line-numbers="1-18|12-13|14-16|1-18"><pre class="sourceCode numberSource python code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-41-1"><a href="#annotated-cell-41-1"></a>user_input <span class="op">=</span> <span class="st">"You are great"</span></span>
<span id="annotated-cell-41-2"><a href="#annotated-cell-41-2"></a>output <span class="op">=</span> llm.create_chat_completion(</span>
<span id="annotated-cell-41-3"><a href="#annotated-cell-41-3"></a>    messages<span class="op">=</span>[</span>
<span id="annotated-cell-41-4"><a href="#annotated-cell-41-4"></a>        {</span>
<span id="annotated-cell-41-5"><a href="#annotated-cell-41-5"></a>            <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="annotated-cell-41-6"><a href="#annotated-cell-41-6"></a>            <span class="st">"content"</span>: (</span>
<span id="annotated-cell-41-7"><a href="#annotated-cell-41-7"></a>                <span class="st">"What is the sentiment conveyed in the following text: "</span></span>
<span id="annotated-cell-41-8"><a href="#annotated-cell-41-8"></a>                <span class="ss">f"</span><span class="sc">{</span>user_input<span class="sc">}</span><span class="ss">."</span></span>
<span id="annotated-cell-41-9"><a href="#annotated-cell-41-9"></a>            ),</span>
<span id="annotated-cell-41-10"><a href="#annotated-cell-41-10"></a>        },</span>
<span id="annotated-cell-41-11"><a href="#annotated-cell-41-11"></a>    ],</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-41" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-41-12" class="code-annotation-target"><a href="#annotated-cell-41-12"></a>    tools<span class="op">=</span>tools,</span>
<span id="annotated-cell-41-13"><a href="#annotated-cell-41-13"></a>    tool_choice<span class="op">=</span>{<span class="st">"type"</span>: <span class="st">"function"</span>, <span class="st">"function"</span>: {<span class="st">"name"</span>: <span class="st">"Sentiment"</span>}},</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-41" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-41-14" class="code-annotation-target"><a href="#annotated-cell-41-14"></a>    logits_processor<span class="op">=</span>transformers.LogitsProcessorList(</span>
<span id="annotated-cell-41-15"><a href="#annotated-cell-41-15"></a>        [outlines_logits_processor]</span>
<span id="annotated-cell-41-16"><a href="#annotated-cell-41-16"></a>    ),</span>
<span id="annotated-cell-41-17"><a href="#annotated-cell-41-17"></a>)</span>
<span id="annotated-cell-41-18"><a href="#annotated-cell-41-18"></a>output[<span class="st">"choices"</span>][<span class="dv">0</span>][<span class="st">"message"</span>][<span class="st">"tool_calls"</span>][<span class="dv">0</span>][<span class="st">"function"</span>][<span class="st">"arguments"</span>]</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-41" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-41" data-code-lines="12,13" data-code-annotation="1">Structured Outputs</span>
</dd>
<dt data-target-cell="annotated-cell-41" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-41" data-code-lines="14,15,16" data-code-annotation="2">Structured Generation</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>'{ "label": "Positive"}'</code></pre>
</div>
</div>
</section>
</section>
<section>
<section id="knowledge-graph-generation" class="title-slide slide level1 center">
<h1>Knowledge Graph Generation</h1>

</section>
<section id="section-9" class="slide level3 nostretch">
<h3></h3>
<p><img data-src="./assets/kuzu-logo.png" title="Kùzu logo" style="width:40.0%"></p>
<p>Graph database: <a href="https://kuzudb.com/">https://kuzudb.com/</a></p>
</section>
<section id="consider-a-text" class="slide level3">
<h3>Consider a text</h3>
<div id="8b2cfc57-b730-4c50-b52d-c73404e2dcf2" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:45.770290Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:45.770142Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:45.773262Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:45.772902Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:45.770276Z&quot;}" data-execution_count="55">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href=""></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'./assets/curie.txt'</span>, <span class="st">"r"</span>) <span class="im">as</span> f:</span>
<span id="cb58-2"><a href=""></a>    curie_text <span class="op">=</span> f.read()</span>
<span id="cb58-3"><a href=""></a><span class="bu">print</span>(curie_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>When Marie Curie came to the United States for the first time, in May 1921, she had already discovered the elements radium and polonium, coined the term “radio-active” and won the Nobel Prize—twice. But the Polish-born scientist, almost pathologically shy and accustomed to spending most of her time in her Paris laboratory, was stunned by the fanfare that greeted her. In 1898 she indeed identified one of the substances and named it polonium, after her homeland. Five months later, she identified a second element, which the world came to know as radium. Curie described the elements she studied as “radio-active.”

In 1894, she met Pierre Curie, a 35-year-old physicist at a French technical college who had been studying crystals and magnetism. More than a decade before, he and his brother Jacques had discovered piezoelectricity, the electric charge produced in solid materials under pressure. Pierre was taken by Marie’s uncommon intellect and drive, and he proposed to her. They were married in 1895 in a civil service attended by family and a few friends.

Both Curies shared the Nobel Prize in physics with Becquerel in 1903. It was the first Nobel to be awarded to a woman. In 1911, rumors spread that Curie was having an affair with the prominent physicist Paul Langevin, a man five years her junior who had been Pierre’s student and had worked closely with Albert Einstein. The front-page coverage of the scandal threatened to overshadow another news story later that year: her second Nobel Prize.

This one, in chemistry, was for the discovery of polonium and radium. In her acceptance speech in Stockholm, she paid tribute to her husband but also made clear that her work was independent from his, spelling out their separate contributions and describing the discoveries she had made after his death.
</code></pre>
</div>
</div>
</section>
<section id="chunk-the-text" class="slide level3">
<h3>Chunk the text</h3>
<div id="77096b83-b94f-4ec1-98bc-6c4412d77f23" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:45.773799Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:45.773667Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:45.796699Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:45.795579Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:45.773786Z&quot;}" data-execution_count="56">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href=""></a>texts <span class="op">=</span> curie_text.split(<span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>)</span>
<span id="cb60-2"><a href=""></a>texts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>['When Marie Curie came to the United States for the first time, in May 1921, she had already discovered the elements radium and polonium, coined the term “radio-active” and won the Nobel Prize—twice. But the Polish-born scientist, almost pathologically shy and accustomed to spending most of her time in her Paris laboratory, was stunned by the fanfare that greeted her. In 1898 she indeed identified one of the substances and named it polonium, after her homeland. Five months later, she identified a second element, which the world came to know as radium. Curie described the elements she studied as “radio-active.”',
 'In 1894, she met Pierre Curie, a 35-year-old physicist at a French technical college who had been studying crystals and magnetism. More than a decade before, he and his brother Jacques had discovered piezoelectricity, the electric charge produced in solid materials under pressure. Pierre was taken by Marie’s uncommon intellect and drive, and he proposed to her. They were married in 1895 in a civil service attended by family and a few friends.',
 'Both Curies shared the Nobel Prize in physics with Becquerel in 1903. It was the first Nobel to be awarded to a woman. In 1911, rumors spread that Curie was having an affair with the prominent physicist Paul Langevin, a man five years her junior who had been Pierre’s student and had worked closely with Albert Einstein. The front-page coverage of the scandal threatened to overshadow another news story later that year: her second Nobel Prize.',
 'This one, in chemistry, was for the discovery of polonium and radium. In her acceptance speech in Stockholm, she paid tribute to her husband but also made clear that her work was independent from his, spelling out their separate contributions and describing the discoveries she had made after his death.\n']</code></pre>
</div>
</div>
</section>
<section id="section-10" class="slide level3">
<h3></h3>
<div id="c05af2cc-dcd0-4c6a-95c9-4d1435389ab7" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:45.798427Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:45.797927Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:45.812114Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:45.811018Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:45.798386Z&quot;}" data-execution_count="57">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href=""></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel, Field</span>
<span id="cb62-2"><a href=""></a><span class="im">from</span> typing <span class="im">import</span> Optional</span>
<span id="cb62-3"><a href=""></a></span>
<span id="cb62-4"><a href=""></a><span class="kw">class</span> Node(BaseModel):</span>
<span id="cb62-5"><a href=""></a>    <span class="co">"""Node of the Knowledge Graph"""</span></span>
<span id="cb62-6"><a href=""></a>    <span class="bu">id</span>: <span class="bu">int</span> <span class="op">=</span> Field(</span>
<span id="cb62-7"><a href=""></a>        ..., description<span class="op">=</span><span class="st">"Unique identifier of the node starting at zero"</span></span>
<span id="cb62-8"><a href=""></a>    )</span>
<span id="cb62-9"><a href=""></a>    <span class="bu">type</span>: <span class="bu">str</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Type of the node"</span>)</span>
<span id="cb62-10"><a href=""></a>    label: <span class="bu">str</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Label of the node"</span>)</span>
<span id="cb62-11"><a href=""></a></span>
<span id="cb62-12"><a href=""></a><span class="kw">class</span> Edge(BaseModel):</span>
<span id="cb62-13"><a href=""></a>    <span class="co">"""Edge of the Knowledge Graph"""</span></span>
<span id="cb62-14"><a href=""></a>    source: <span class="bu">int</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Unique source of the edge"</span>)</span>
<span id="cb62-15"><a href=""></a>    target: <span class="bu">int</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Unique target of the edge"</span>)</span>
<span id="cb62-16"><a href=""></a>    <span class="bu">type</span>: <span class="bu">str</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Type of the edge"</span>)</span>
<span id="cb62-17"><a href=""></a>    label: <span class="bu">str</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Label of the edge"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-11" class="slide level3">
<h3></h3>
<div id="f496e731-b887-482c-ae15-03a70b217844" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:45.825861Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:45.825358Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:45.846955Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:45.845837Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:45.825820Z&quot;}" data-execution_count="59">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href=""></a><span class="im">from</span> typing <span class="im">import</span> List</span>
<span id="cb63-2"><a href=""></a><span class="im">from</span> langchain_core.utils.function_calling <span class="im">import</span> convert_to_openai_tool</span>
<span id="cb63-3"><a href=""></a></span>
<span id="cb63-4"><a href=""></a><span class="kw">class</span> KnowledgeGraph(BaseModel):</span>
<span id="cb63-5"><a href=""></a>    <span class="co">"""Generated Knowledge Graph"""</span></span>
<span id="cb63-6"><a href=""></a>    nodes: List[Node] <span class="op">=</span> Field(</span>
<span id="cb63-7"><a href=""></a>        ..., description<span class="op">=</span><span class="st">"List of nodes of the knowledge graph"</span>)</span>
<span id="cb63-8"><a href=""></a>    edges: List[Edge] <span class="op">=</span> Field(</span>
<span id="cb63-9"><a href=""></a>        ..., description<span class="op">=</span><span class="st">"List of edges of the knowledge graph"</span>)</span>
<span id="cb63-10"><a href=""></a></span>
<span id="cb63-11"><a href=""></a>tools <span class="op">=</span> [convert_to_openai_tool(KnowledgeGraph)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-12" class="slide level3">
<h3></h3>
<div id="7441237a-43a3-4b6e-b5e2-d02e3d79b291" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:45.848737Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:45.848230Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:45.859002Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:45.857873Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:45.848695Z&quot;}" data-execution_count="60">
<div class="sourceCode cell-code" id="cb64" data-code-line-numbers="6-9,14-15|1-18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href=""></a><span class="kw">def</span> build_messages(text: <span class="bu">str</span>):</span>
<span id="cb64-2"><a href=""></a>    messages <span class="op">=</span> [</span>
<span id="cb64-3"><a href=""></a>        {</span>
<span id="cb64-4"><a href=""></a>            <span class="st">"role"</span>: <span class="st">"system"</span>,</span>
<span id="cb64-5"><a href=""></a>            <span class="st">"content"</span>: (</span>
<span id="cb64-6"><a href=""></a>                <span class="st">"You are a world class AI model who answers questions "</span> </span>
<span id="cb64-7"><a href=""></a>                <span class="st">"in JSON with correct Pydantic schema. "</span></span>
<span id="cb64-8"><a href=""></a>                <span class="st">"Here's the json schema you must adhere to:</span><span class="ch">\n</span><span class="st">&lt;schema&gt;</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb64-9"><a href=""></a>                <span class="ss">f"</span><span class="sc">{</span>KnowledgeGraph<span class="sc">.</span>schema_json()<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/schema&gt;"</span></span>
<span id="cb64-10"><a href=""></a>            )</span>
<span id="cb64-11"><a href=""></a>        },{</span>
<span id="cb64-12"><a href=""></a>            <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb64-13"><a href=""></a>            <span class="st">"content"</span>: (</span>
<span id="cb64-14"><a href=""></a>                <span class="st">"Describe the following text as a detailed "</span> </span>
<span id="cb64-15"><a href=""></a>                <span class="ss">f"knowledge graph:</span><span class="ch">\n</span><span class="sc">{</span>text<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb64-16"><a href=""></a>            )</span>
<span id="cb64-17"><a href=""></a>        }]</span>
<span id="cb64-18"><a href=""></a>    <span class="cf">return</span> messages</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-13" class="slide level3">
<h3></h3>
<div id="f7f3f89e-3984-409d-8293-ba91210fb714" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:45.885073Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:45.884682Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:43:45.890406Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:43:45.889644Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:45.885044Z&quot;}" data-execution_count="62">
<div class="sourceCode cell-code" id="annotated-cell-47" data-code-line-numbers="9-13|1-18"><pre class="sourceCode numberSource python code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-47-1"><a href="#annotated-cell-47-1"></a><span class="kw">def</span> generate_assistant_message(messages):</span>
<span id="annotated-cell-47-2"><a href="#annotated-cell-47-2"></a>    outlines_logits_processor <span class="op">=</span> outlines.processors.JSONLogitsProcessor(</span>
<span id="annotated-cell-47-3"><a href="#annotated-cell-47-3"></a>        KnowledgeGraph,</span>
<span id="annotated-cell-47-4"><a href="#annotated-cell-47-4"></a>        outlines_tokenizer,</span>
<span id="annotated-cell-47-5"><a href="#annotated-cell-47-5"></a>        whitespace_pattern<span class="op">=</span><span class="vs">r"[\n\t ]*"</span></span>
<span id="annotated-cell-47-6"><a href="#annotated-cell-47-6"></a>    )</span>
<span id="annotated-cell-47-7"><a href="#annotated-cell-47-7"></a>    output <span class="op">=</span> llm.create_chat_completion(</span>
<span id="annotated-cell-47-8"><a href="#annotated-cell-47-8"></a>        messages<span class="op">=</span>messages,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-47" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-47-9" class="code-annotation-target"><a href="#annotated-cell-47-9"></a>        tools<span class="op">=</span>tools,</span>
<span id="annotated-cell-47-10"><a href="#annotated-cell-47-10"></a>        tool_choice<span class="op">=</span>{<span class="st">"type"</span>: <span class="st">"function"</span>, </span>
<span id="annotated-cell-47-11"><a href="#annotated-cell-47-11"></a>                     <span class="st">"function"</span>: {<span class="st">"name"</span>: <span class="st">"KnowledgeGraph"</span>}},</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-47" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-47-12" class="code-annotation-target"><a href="#annotated-cell-47-12"></a>        logits_processor<span class="op">=</span>transformers.LogitsProcessorList(</span>
<span id="annotated-cell-47-13"><a href="#annotated-cell-47-13"></a>            [outlines_logits_processor]),</span>
<span id="annotated-cell-47-14"><a href="#annotated-cell-47-14"></a>        temperature<span class="op">=</span><span class="dv">0</span>,</span>
<span id="annotated-cell-47-15"><a href="#annotated-cell-47-15"></a>        seed<span class="op">=</span><span class="dv">42</span>,</span>
<span id="annotated-cell-47-16"><a href="#annotated-cell-47-16"></a>        max_tokens<span class="op">=</span><span class="dv">5000</span>,</span>
<span id="annotated-cell-47-17"><a href="#annotated-cell-47-17"></a>    )</span>
<span id="annotated-cell-47-18"><a href="#annotated-cell-47-18"></a>    <span class="cf">return</span> output[<span class="st">"choices"</span>][<span class="dv">0</span>][<span class="st">"message"</span>]</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-47" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-47" data-code-lines="9" data-code-annotation="1">Structured Outputs</span>
</dd>
<dt data-target-cell="annotated-cell-47" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-47" data-code-lines="12" data-code-annotation="2">Structured Generation</span>
</dd>
</dl>
</div>
</div>
</section>
<section id="section-14" class="title-slide slide level2 center">
<h2></h2>
<div id="b4dfcf8c-46d8-40f1-9e23-7ab31febf9cb" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:43:58.180506Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:43:58.180343Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:44:02.126717Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:44:02.126030Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:43:58.180490Z&quot;}" data-execution_count="64">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href=""></a><span class="kw">def</span> generate_kg(text):</span>
<span id="cb65-2"><a href=""></a>    messages <span class="op">=</span> build_messages(text)</span>
<span id="cb65-3"><a href=""></a>    assistant_message <span class="op">=</span> generate_assistant_message(messages)</span>
<span id="cb65-4"><a href=""></a>    <span class="cf">return</span> assistant_message[<span class="st">"tool_calls"</span>][<span class="dv">0</span>][<span class="st">"function"</span>][<span class="st">"arguments"</span>]</span>
<span id="cb65-5"><a href=""></a>    </span>
<span id="cb65-6"><a href=""></a>generate_kg(<span class="st">"Alice loves Bob"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<pre><code>'{"nodes": [{"id": 0, "type": "Person", "label": "Alice"}, {"id": 1, "type": "Person", "label": "Bob"}], "edges": [{"source": 0, "target": 1, "type": "LOVES", "label": "loves"}]}'</code></pre>
</div>
</div>
</section>

<section id="section-15" class="title-slide slide level2 center">
<h2></h2>
<div id="e2a213e3-1264-4622-be22-356cfc93f6dd" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:44:06.094827Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:44:06.094663Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:45:23.613033Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:45:23.612208Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:44:06.094812Z&quot;}" data-execution_count="66">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href=""></a><span class="im">import</span> json</span>
<span id="cb67-2"><a href=""></a></span>
<span id="cb67-3"><a href=""></a>nodes, edges <span class="op">=</span> [], []</span>
<span id="cb67-4"><a href=""></a><span class="cf">for</span> text <span class="kw">in</span> texts:</span>
<span id="cb67-5"><a href=""></a>    kg <span class="op">=</span> generate_kg(text)</span>
<span id="cb67-6"><a href=""></a>    nodes.append(json.loads(kg)[<span class="st">"nodes"</span>])</span>
<span id="cb67-7"><a href=""></a>    edges.append(json.loads(kg)[<span class="st">"edges"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="node-and-edge-type-candidates" class="slide level3">
<h3>Node and Edge Type Candidates</h3>
<div id="8bb6b338-f55f-48be-8be0-d8ce1b881559" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:45:23.613841Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:45:23.613685Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:45:23.618614Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:45:23.617960Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:45:23.613827Z&quot;}" data-execution_count="67">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href=""></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb68-2"><a href=""></a></span>
<span id="cb68-3"><a href=""></a><span class="bu">print</span>(</span>
<span id="cb68-4"><a href=""></a>    Counter([node[<span class="st">"type"</span>].upper() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(texts)) </span>
<span id="cb68-5"><a href=""></a>             <span class="cf">for</span> node <span class="kw">in</span> nodes[i]])</span>
<span id="cb68-6"><a href=""></a>)</span>
<span id="cb68-7"><a href=""></a><span class="bu">print</span>(</span>
<span id="cb68-8"><a href=""></a>    Counter([edge[<span class="st">"type"</span>].upper() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(texts)) </span>
<span id="cb68-9"><a href=""></a>             <span class="cf">for</span> edge <span class="kw">in</span> edges[i]])</span>
<span id="cb68-10"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Counter({'PERSON': 11, 'CONCEPT': 4, 'COUNTRY': 2, 'ELEMENT': 2, 'EVENT': 2, 'CHEMICALELEMENT': 2, 'AWARD': 1})
Counter({'DISCOVERED': 5, 'STUDIED': 4, 'AWARD': 3, 'MARRIED': 2, 'RELATED_TO': 2, 'RECEIVED': 2, 'DECEASED': 2, 'BORN_IN': 1, 'VISITED': 1, 'COINED': 1, 'NAMED_AFTER': 1, 'IS': 1, 'MET': 1, 'BROTHER': 1, 'PROPOSED': 1, 'MARRIAGE': 1, 'AFFAIR': 1, 'COLLABORATION': 1})</code></pre>
</div>
</div>
</section>
<section id="section-16" class="slide level3" data-auto-animate="true">
<h3 data-id="quarto-animate-title"></h3>
<div id="3b02acea-9e86-4ea9-8407-a178ad14cab6" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:45:23.619263Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:45:23.619135Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:45:23.640040Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:45:23.638933Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:45:23.619250Z&quot;}" data-execution_count="68">
<div class="sourceCode cell-code" id="cb70" data-code-line-numbers="8,14"><pre class="sourceCode numberSource python number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode python hljs"><span id="cb70-1" class="hljs-ln-code"><a href=""></a><span class="im">from</span> typing <span class="im">import</span> Literal, Optional</span>
<span id="cb70-2" class="hljs-ln-code"><a href=""></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel, Field</span>
<span id="cb70-3" class="hljs-ln-code"><a href=""></a></span>
<span id="cb70-4" class="hljs-ln-code"><a href=""></a><span class="kw">class</span> Node(BaseModel):</span>
<span id="cb70-5" class="hljs-ln-code"><a href=""></a>    <span class="co">"""Node of the Knowledge Graph"""</span></span>
<span id="cb70-6" class="hljs-ln-code"><a href=""></a>    <span class="bu">id</span>: <span class="bu">int</span> <span class="op">=</span> Field(</span>
<span id="cb70-7" class="hljs-ln-code"><a href=""></a>        ..., description<span class="op">=</span><span class="st">"Unique identifier of the node starting at zero"</span>)</span>
<span id="cb70-8" class="hljs-ln-code"><a href=""></a>    <span class="bu">type</span>: <span class="bu">str</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Type of the node"</span>)</span>
<span id="cb70-9" class="hljs-ln-code"><a href=""></a>    label: <span class="bu">str</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Label of the node"</span>)</span>
<span id="cb70-10" class="hljs-ln-code"><a href=""></a></span>
<span id="cb70-11" class="hljs-ln-code"><a href=""></a><span class="kw">class</span> Edge(BaseModel):</span>
<span id="cb70-12" class="hljs-ln-code"><a href=""></a>    <span class="co">"""Edge of the Knowledge Graph"""</span></span>
<span id="cb70-13" class="hljs-ln-code"><a href=""></a>    source: <span class="bu">int</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Unique source of the edge"</span>)</span>
<span id="cb70-14" class="hljs-ln-code"><a href=""></a>    target: <span class="bu">int</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Unique target of the edge"</span>)</span>
<span id="cb70-15" class="hljs-ln-code"><a href=""></a>    <span class="bu">type</span>: <span class="bu">str</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Type of the edge"</span>)</span>
<span id="cb70-16" class="hljs-ln-code"><a href=""></a>    label: <span class="bu">str</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Label of the edge"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-17" class="slide level3" data-auto-animate="true">
<h3 data-id="quarto-animate-title"></h3>
<div id="22790ddc-7a28-48a5-81ef-e20e5dde1fdb" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:45:23.640815Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:45:23.640610Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:45:23.660460Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:45:23.659473Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:45:23.640795Z&quot;}" data-execution_count="69">
<div class="sourceCode cell-code" id="cb71" data-code-line-numbers="7-9,15-17"><pre class="sourceCode numberSource python number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode python hljs"><span id="cb71-1" class="hljs-ln-code"><a href=""></a><span class="im">from</span> typing <span class="im">import</span> Literal, Optional</span>
<span id="cb71-2" class="hljs-ln-code"><a href=""></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel, Field</span>
<span id="cb71-3" class="hljs-ln-code"><a href=""></a><span class="kw">class</span> Node(BaseModel):</span>
<span id="cb71-4" class="hljs-ln-code"><a href=""></a>    <span class="co">"""Node of the Knowledge Graph"""</span></span>
<span id="cb71-5" class="hljs-ln-code"><a href=""></a>    <span class="bu">id</span>: <span class="bu">int</span> <span class="op">=</span> Field(</span>
<span id="cb71-6" class="hljs-ln-code"><a href=""></a>        ..., description<span class="op">=</span><span class="st">"Unique identifier of the node starting at zero"</span>)</span>
<span id="cb71-7" class="hljs-ln-code"><a href=""></a>    <span class="bu">type</span>: Literal[</span>
<span id="cb71-8" class="hljs-ln-code"><a href=""></a>    <span class="st">"PERSON"</span>, <span class="st">"AWARD"</span>, <span class="st">"DISCOVERY"</span>, <span class="st">"LOCATION"</span>, <span class="st">"OTHER"</span></span>
<span id="cb71-9" class="hljs-ln-code"><a href=""></a>    ] <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Type of the node"</span>)</span>
<span id="cb71-10" class="hljs-ln-code"><a href=""></a>    label: <span class="bu">str</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Label of the node"</span>)</span>
<span id="cb71-11" class="hljs-ln-code"><a href=""></a><span class="kw">class</span> Edge(BaseModel):</span>
<span id="cb71-12" class="hljs-ln-code"><a href=""></a>    <span class="co">"""Edge of the Knowledge Graph"""</span></span>
<span id="cb71-13" class="hljs-ln-code"><a href=""></a>    source: <span class="bu">int</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Unique source of the edge"</span>)</span>
<span id="cb71-14" class="hljs-ln-code"><a href=""></a>    target: <span class="bu">int</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Unique target of the edge"</span>)</span>
<span id="cb71-15" class="hljs-ln-code"><a href=""></a>    <span class="bu">type</span>: Literal[</span>
<span id="cb71-16" class="hljs-ln-code"><a href=""></a>    <span class="st">"DISCOVERED"</span>, <span class="st">"AWARDED"</span>, <span class="st">"INTERPERSONALRELATIONSHIP"</span>, <span class="st">"VISITED"</span>, <span class="st">"OTHER"</span></span>
<span id="cb71-17" class="hljs-ln-code"><a href=""></a>    ] <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Type of the edge"</span>)</span>
<span id="cb71-18" class="hljs-ln-code"><a href=""></a>    label: <span class="bu">str</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Label of the edge"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-18" class="slide level3">
<h3></h3>
<div class="panel-tabset">
<ul id="tabset-1" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-1-1">Chunk 1</a></li><li><a href="#tabset-1-2">Chunk 2</a></li><li><a href="#tabset-1-3">Chunk 3</a></li><li><a href="#tabset-1-4">Chunk 4</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1">
<div id="26b720e8-981a-488e-8ed4-340ab24524bc" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:49:16.063245Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:49:16.062544Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:49:16.202083Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:49:16.201013Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:49:16.063187Z&quot;}" data-execution_count="74">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href=""></a><span class="im">from</span> graphviz <span class="im">import</span> Digraph</span>
<span id="cb72-2"><a href=""></a></span>
<span id="cb72-3"><a href=""></a>dot <span class="op">=</span> Digraph()</span>
<span id="cb72-4"><a href=""></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb72-5"><a href=""></a><span class="cf">for</span> node <span class="kw">in</span> nodes[i]:</span>
<span id="cb72-6"><a href=""></a>    <span class="cf">if</span> node[<span class="st">'type'</span>] <span class="op">!=</span> <span class="st">"OTHER"</span>:</span>
<span id="cb72-7"><a href=""></a>        dot.node(<span class="bu">str</span>(node[<span class="st">'id'</span>]), node[<span class="st">'type'</span>]<span class="op">+</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span><span class="op">+</span>node[<span class="st">'label'</span>], shape<span class="op">=</span><span class="st">'circle'</span>, width<span class="op">=</span><span class="st">'1'</span>, height<span class="op">=</span><span class="st">'1'</span>)</span>
<span id="cb72-8"><a href=""></a><span class="cf">for</span> edge <span class="kw">in</span> edges[i]:</span>
<span id="cb72-9"><a href=""></a>    <span class="cf">if</span> edge[<span class="st">"type"</span>] <span class="op">!=</span> <span class="st">"OTHER"</span>: <span class="co">#and nodes[i][edge["source"]]["type"]!= "OTHER" and nodes[i][edge["target"]]["type"]!= "OTHER":</span></span>
<span id="cb72-10"><a href=""></a>        dot.edge(<span class="bu">str</span>(edge[<span class="st">'source'</span>]), <span class="bu">str</span>(edge[<span class="st">'target'</span>]), label<span class="op">=</span>edge[<span class="st">'type'</span>]<span class="op">+</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span><span class="op">+</span> edge[<span class="st">'label'</span>])</span>
<span id="cb72-11"><a href=""></a><span class="bu">print</span>(texts[i])</span>
<span id="cb72-12"><a href=""></a>dot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>When Marie Curie came to the United States for the first time, in May 1921, she had already discovered the elements radium and polonium, coined the term “radio-active” and won the Nobel Prize—twice. But the Polish-born scientist, almost pathologically shy and accustomed to spending most of her time in her Paris laboratory, was stunned by the fanfare that greeted her. In 1898 she indeed identified one of the substances and named it polonium, after her homeland. Five months later, she identified a second element, which the world came to know as radium. Curie described the elements she studied as “radio-active.”</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="74">
<div>
<figure>
<p><img data-src="IADevs_files/figure-revealjs/cell-74-output-2.svg"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-2">
<div id="708cae0a-2caa-444b-a75f-4a5398651c21" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:49:21.147918Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:49:21.147430Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:49:21.217541Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:49:21.216770Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:49:21.147873Z&quot;}" data-execution_count="75">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href=""></a><span class="im">from</span> graphviz <span class="im">import</span> Digraph</span>
<span id="cb74-2"><a href=""></a></span>
<span id="cb74-3"><a href=""></a>dot <span class="op">=</span> Digraph()</span>
<span id="cb74-4"><a href=""></a>i <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb74-5"><a href=""></a><span class="cf">for</span> node <span class="kw">in</span> nodes[i]:</span>
<span id="cb74-6"><a href=""></a>    <span class="cf">if</span> node[<span class="st">'type'</span>] <span class="op">!=</span> <span class="st">"OTHER"</span>:</span>
<span id="cb74-7"><a href=""></a>        dot.node(<span class="bu">str</span>(node[<span class="st">'id'</span>]), node[<span class="st">'type'</span>]<span class="op">+</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span><span class="op">+</span>node[<span class="st">'label'</span>], shape<span class="op">=</span><span class="st">'circle'</span>, width<span class="op">=</span><span class="st">'1'</span>, height<span class="op">=</span><span class="st">'1'</span>)</span>
<span id="cb74-8"><a href=""></a><span class="cf">for</span> edge <span class="kw">in</span> edges[i]:</span>
<span id="cb74-9"><a href=""></a>    <span class="cf">if</span> edge[<span class="st">"type"</span>] <span class="op">!=</span> <span class="st">"OTHER"</span>: <span class="co">#and nodes[i][edge["source"]]["type"]!= "OTHER" and nodes[i][edge["target"]]["type"]!= "OTHER":</span></span>
<span id="cb74-10"><a href=""></a>        dot.edge(<span class="bu">str</span>(edge[<span class="st">'source'</span>]), <span class="bu">str</span>(edge[<span class="st">'target'</span>]), label<span class="op">=</span>edge[<span class="st">'type'</span>]<span class="op">+</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span><span class="op">+</span> edge[<span class="st">'label'</span>])</span>
<span id="cb74-11"><a href=""></a><span class="bu">print</span>(texts[i])</span>
<span id="cb74-12"><a href=""></a>dot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>In 1894, she met Pierre Curie, a 35-year-old physicist at a French technical college who had been studying crystals and magnetism. More than a decade before, he and his brother Jacques had discovered piezoelectricity, the electric charge produced in solid materials under pressure. Pierre was taken by Marie’s uncommon intellect and drive, and he proposed to her. They were married in 1895 in a civil service attended by family and a few friends.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="75">
<div>
<figure>
<p><img data-src="IADevs_files/figure-revealjs/cell-75-output-2.svg"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-3">
<div id="e87f2416-5fe9-4acc-868b-0c5f00bb34c6" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:49:22.253504Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:49:22.253028Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:49:22.335512Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:49:22.334458Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:49:22.253458Z&quot;}" data-execution_count="76">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href=""></a><span class="im">from</span> graphviz <span class="im">import</span> Digraph</span>
<span id="cb76-2"><a href=""></a></span>
<span id="cb76-3"><a href=""></a>dot <span class="op">=</span> Digraph()</span>
<span id="cb76-4"><a href=""></a>i <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb76-5"><a href=""></a><span class="cf">for</span> node <span class="kw">in</span> nodes[i]:</span>
<span id="cb76-6"><a href=""></a>    <span class="cf">if</span> node[<span class="st">'type'</span>] <span class="op">!=</span> <span class="st">"OTHER"</span>:</span>
<span id="cb76-7"><a href=""></a>        dot.node(<span class="bu">str</span>(node[<span class="st">'id'</span>]), node[<span class="st">'type'</span>]<span class="op">+</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span><span class="op">+</span>node[<span class="st">'label'</span>], shape<span class="op">=</span><span class="st">'circle'</span>, width<span class="op">=</span><span class="st">'1'</span>, height<span class="op">=</span><span class="st">'1'</span>)</span>
<span id="cb76-8"><a href=""></a><span class="cf">for</span> edge <span class="kw">in</span> edges[i]:</span>
<span id="cb76-9"><a href=""></a>    <span class="cf">if</span> edge[<span class="st">"type"</span>] <span class="op">!=</span> <span class="st">"OTHER"</span>: <span class="co">#and nodes[i][edge["source"]]["type"]!= "OTHER" and nodes[i][edge["target"]]["type"]!= "OTHER":</span></span>
<span id="cb76-10"><a href=""></a>        dot.edge(<span class="bu">str</span>(edge[<span class="st">'source'</span>]), <span class="bu">str</span>(edge[<span class="st">'target'</span>]), label<span class="op">=</span>edge[<span class="st">'type'</span>]<span class="op">+</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span><span class="op">+</span> edge[<span class="st">'label'</span>])</span>
<span id="cb76-11"><a href=""></a><span class="bu">print</span>(texts[i])</span>
<span id="cb76-12"><a href=""></a>dot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Both Curies shared the Nobel Prize in physics with Becquerel in 1903. It was the first Nobel to be awarded to a woman. In 1911, rumors spread that Curie was having an affair with the prominent physicist Paul Langevin, a man five years her junior who had been Pierre’s student and had worked closely with Albert Einstein. The front-page coverage of the scandal threatened to overshadow another news story later that year: her second Nobel Prize.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="76">
<div>
<figure>
<p><img data-src="IADevs_files/figure-revealjs/cell-76-output-2.svg"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-4">
<div id="57a9f50c-73fd-4ffb-b8ac-064e78188996" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:49:23.366026Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:49:23.365553Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:49:23.443323Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:49:23.441952Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:49:23.365982Z&quot;}" data-execution_count="77">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href=""></a><span class="im">from</span> graphviz <span class="im">import</span> Digraph</span>
<span id="cb78-2"><a href=""></a></span>
<span id="cb78-3"><a href=""></a>dot <span class="op">=</span> Digraph()</span>
<span id="cb78-4"><a href=""></a>i <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb78-5"><a href=""></a><span class="cf">for</span> node <span class="kw">in</span> nodes[i]:</span>
<span id="cb78-6"><a href=""></a>    <span class="cf">if</span> node[<span class="st">'type'</span>] <span class="op">!=</span> <span class="st">"OTHER"</span>:</span>
<span id="cb78-7"><a href=""></a>        dot.node(<span class="bu">str</span>(node[<span class="st">'id'</span>]), node[<span class="st">'type'</span>]<span class="op">+</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span><span class="op">+</span>node[<span class="st">'label'</span>], shape<span class="op">=</span><span class="st">'circle'</span>, width<span class="op">=</span><span class="st">'1'</span>, height<span class="op">=</span><span class="st">'1'</span>)</span>
<span id="cb78-8"><a href=""></a><span class="cf">for</span> edge <span class="kw">in</span> edges[i]:</span>
<span id="cb78-9"><a href=""></a>    <span class="cf">if</span> edge[<span class="st">"type"</span>] <span class="op">!=</span> <span class="st">"OTHER"</span>:</span>
<span id="cb78-10"><a href=""></a>        dot.edge(<span class="bu">str</span>(edge[<span class="st">'source'</span>]), <span class="bu">str</span>(edge[<span class="st">'target'</span>]), label<span class="op">=</span>edge[<span class="st">'type'</span>]<span class="op">+</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span><span class="op">+</span> edge[<span class="st">'label'</span>])</span>
<span id="cb78-11"><a href=""></a><span class="bu">print</span>(texts[i])</span>
<span id="cb78-12"><a href=""></a>dot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>This one, in chemistry, was for the discovery of polonium and radium. In her acceptance speech in Stockholm, she paid tribute to her husband but also made clear that her work was independent from his, spelling out their separate contributions and describing the discoveries she had made after his death.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="77">
<div>
<figure>
<p><img data-src="IADevs_files/figure-revealjs/cell-77-output-2.svg"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="section-19" class="slide level3">
<h3></h3>
<div id="afe3c6c0-ba3c-4410-a0a0-75a58626d744" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:49:24.573732Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:49:24.573262Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:49:24.598482Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:49:24.597323Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:49:24.573687Z&quot;}" data-execution_count="78">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href=""></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb80-2"><a href=""></a></span>
<span id="cb80-3"><a href=""></a>df_nodes <span class="op">=</span> pd.DataFrame(nodes[<span class="dv">0</span>])</span>
<span id="cb80-4"><a href=""></a>df_edges <span class="op">=</span> pd.DataFrame({</span>
<span id="cb80-5"><a href=""></a>    <span class="st">'source'</span>: [nodes[<span class="dv">0</span>][edge[<span class="st">'source'</span>]][<span class="st">'label'</span>] <span class="cf">for</span> edge <span class="kw">in</span> edges[<span class="dv">0</span>]],</span>
<span id="cb80-6"><a href=""></a>    <span class="st">'target'</span>: [nodes[<span class="dv">0</span>][edge[<span class="st">'target'</span>]][<span class="st">'label'</span>] <span class="cf">for</span> edge <span class="kw">in</span> edges[<span class="dv">0</span>]],</span>
<span id="cb80-7"><a href=""></a>    <span class="st">'type'</span>: [edge[<span class="st">'type'</span>] <span class="cf">for</span> edge <span class="kw">in</span> edges[<span class="dv">0</span>]],</span>
<span id="cb80-8"><a href=""></a>    <span class="st">'label'</span>: [edge[<span class="st">'label'</span>] <span class="cf">for</span> edge <span class="kw">in</span> edges[<span class="dv">0</span>]]</span>
<span id="cb80-9"><a href=""></a>})</span>
<span id="cb80-10"><a href=""></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="bu">len</span>(texts)):</span>
<span id="cb80-11"><a href=""></a>    df_nodes_aux <span class="op">=</span> pd.DataFrame({</span>
<span id="cb80-12"><a href=""></a>        <span class="st">'id'</span>: [node[<span class="st">'id'</span>]<span class="op">+</span><span class="bu">len</span>(df_nodes) <span class="cf">for</span> node <span class="kw">in</span> nodes[i]],</span>
<span id="cb80-13"><a href=""></a>        <span class="st">'label'</span>: [node[<span class="st">'label'</span>] <span class="cf">for</span> node <span class="kw">in</span> nodes[i]],</span>
<span id="cb80-14"><a href=""></a>        <span class="st">'type'</span>: [node[<span class="st">'type'</span>] <span class="cf">for</span> node <span class="kw">in</span> nodes[i]]</span>
<span id="cb80-15"><a href=""></a>    })</span>
<span id="cb80-16"><a href=""></a>    df_edges_aux <span class="op">=</span> pd.DataFrame({</span>
<span id="cb80-17"><a href=""></a>        <span class="st">'source'</span>: [nodes[i][edge[<span class="st">'source'</span>]][<span class="st">'label'</span>] <span class="cf">for</span> edge <span class="kw">in</span> edges[i]],</span>
<span id="cb80-18"><a href=""></a>        <span class="st">'target'</span>: [nodes[i][edge[<span class="st">'target'</span>]][<span class="st">'label'</span>] <span class="cf">for</span> edge <span class="kw">in</span> edges[i]],</span>
<span id="cb80-19"><a href=""></a>        <span class="st">'type'</span>: [edge[<span class="st">'type'</span>] <span class="cf">for</span> edge <span class="kw">in</span> edges[i]],</span>
<span id="cb80-20"><a href=""></a>        <span class="st">'label'</span>: [edge[<span class="st">'label'</span>] <span class="cf">for</span> edge <span class="kw">in</span> edges[i]]</span>
<span id="cb80-21"><a href=""></a>    })</span>
<span id="cb80-22"><a href=""></a>    df_nodes <span class="op">=</span> pd.concat([df_nodes, df_nodes_aux])</span>
<span id="cb80-23"><a href=""></a>    df_edges <span class="op">=</span> pd.concat([df_edges, df_edges_aux])</span>
<span id="cb80-24"><a href=""></a></span>
<span id="cb80-25"><a href=""></a>df_nodes<span class="op">=</span>df_nodes[df_nodes[<span class="st">"type"</span>]<span class="op">!=</span><span class="st">"OTHER"</span>].drop_duplicates(subset<span class="op">=</span><span class="st">"label"</span>)</span>
<span id="cb80-26"><a href=""></a>df_edges<span class="op">=</span>df_edges[df_edges[<span class="st">"type"</span>]<span class="op">!=</span><span class="st">"OTHER"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="insert-nodes-to-the-graph-db" class="slide level3">
<h3>Insert nodes to the graph db</h3>
<div id="4ad0957f-e50f-49ab-9a59-e8ab00ffdd3c" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:49:25.626778Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:49:25.626314Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:49:25.907850Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:49:25.906916Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:49:25.626733Z&quot;}" data-execution_count="79">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href=""></a><span class="im">import</span> kuzu</span>
<span id="cb81-2"><a href=""></a></span>
<span id="cb81-3"><a href=""></a>db <span class="op">=</span> kuzu.Database()</span>
<span id="cb81-4"><a href=""></a>conn <span class="op">=</span> kuzu.Connection(db)</span>
<span id="cb81-5"><a href=""></a><span class="co"># create schema</span></span>
<span id="cb81-6"><a href=""></a>conn.execute(<span class="st">"CREATE NODE TABLE Person(name STRING, PRIMARY KEY (name))"</span>)<span class="op">;</span></span>
<span id="cb81-7"><a href=""></a>conn.execute(<span class="st">"CREATE NODE TABLE Award(name STRING, PRIMARY KEY (name))"</span>)<span class="op">;</span></span>
<span id="cb81-8"><a href=""></a>conn.execute(<span class="st">"CREATE NODE TABLE Discovery(name STRING, PRIMARY KEY (name))"</span>)<span class="op">;</span></span>
<span id="cb81-9"><a href=""></a>conn.execute(<span class="st">"CREATE NODE TABLE Location(name STRING, PRIMARY KEY (name))"</span>)<span class="op">;</span></span>
<span id="cb81-10"><a href=""></a><span class="co"># copy from dataframes</span></span>
<span id="cb81-11"><a href=""></a>df_nodes_person <span class="op">=</span> df_nodes[df_nodes[<span class="st">"type"</span>] <span class="op">==</span> <span class="st">"PERSON"</span>][[<span class="st">"label"</span>]]</span>
<span id="cb81-12"><a href=""></a>df_nodes_award <span class="op">=</span> df_nodes[df_nodes[<span class="st">"type"</span>] <span class="op">==</span> <span class="st">"AWARD"</span>][[<span class="st">"label"</span>]]</span>
<span id="cb81-13"><a href=""></a>df_nodes_discovery <span class="op">=</span> df_nodes[df_nodes[<span class="st">"type"</span>] <span class="op">==</span> <span class="st">"DISCOVERY"</span>][[<span class="st">"label"</span>]]</span>
<span id="cb81-14"><a href=""></a>df_nodes_location <span class="op">=</span> df_nodes[df_nodes[<span class="st">"type"</span>] <span class="op">==</span> <span class="st">"LOCATION"</span>][[<span class="st">"label"</span>]]</span>
<span id="cb81-15"><a href=""></a>conn.execute(<span class="st">"COPY Person FROM df_nodes_person"</span>)<span class="op">;</span></span>
<span id="cb81-16"><a href=""></a>conn.execute(<span class="st">"COPY Award FROM df_nodes_award"</span>)<span class="op">;</span></span>
<span id="cb81-17"><a href=""></a>conn.execute(<span class="st">"COPY Discovery FROM df_nodes_discovery"</span>)<span class="op">;</span></span>
<span id="cb81-18"><a href=""></a>conn.execute(<span class="st">"COPY Location FROM df_nodes_location"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="check-for-nodes" class="slide level3">
<h3>Check for nodes</h3>
<div id="3caa6640-daac-4a6c-8ea0-d6fe6d39104e" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:49:26.946975Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:49:26.946475Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:49:26.955456Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:49:26.954150Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:49:26.946929Z&quot;}" data-execution_count="80">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href=""></a>result <span class="op">=</span> conn.execute(<span class="st">"MATCH (person:Person) RETURN person.name;"</span>)</span>
<span id="cb82-2"><a href=""></a><span class="cf">while</span> result.has_next():</span>
<span id="cb82-3"><a href=""></a>    <span class="bu">print</span>(result.get_next())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['Marie Curie']
['Pierre Curie']
['Henri Becquerel']
['Paul Langevin']</code></pre>
</div>
</div>
</section>
<section id="insert-edges-to-the-graph-db" class="slide level3">
<h3>Insert edges to the graph db</h3>
<div id="3f26535a-7ce4-4f72-86df-e9d633818a56" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:49:27.982924Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:49:27.982458Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:49:28.036027Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:49:28.034753Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:49:27.982881Z&quot;}" data-scrolled="true" data-execution_count="81">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href=""></a>conn.execute(<span class="st">"CREATE REL TABLE Awarded(FROM Person TO Award)"</span>)<span class="op">;</span> <span class="co"># create schema</span></span>
<span id="cb84-2"><a href=""></a>conn.execute(<span class="st">"CREATE REL TABLE Discovered(FROM Person TO Discovery)"</span>)<span class="op">;</span></span>
<span id="cb84-3"><a href=""></a>conn.execute(<span class="st">"CREATE REL TABLE Interpersonal_Relationship(FROM Person TO Person)"</span>)<span class="op">;</span></span>
<span id="cb84-4"><a href=""></a>conn.execute(<span class="st">"CREATE REL TABLE Visited(FROM Person TO Location)"</span>)<span class="op">;</span></span>
<span id="cb84-5"><a href=""></a><span class="kw">def</span> my_func(edge_type: <span class="bu">str</span>, source: <span class="bu">str</span>, target: <span class="bu">str</span>):</span>
<span id="cb84-6"><a href=""></a>    mask1 <span class="op">=</span> [a <span class="kw">in</span> <span class="bu">list</span>(df_nodes[df_nodes[<span class="st">"type"</span>] <span class="op">==</span> source][<span class="st">'label'</span>]) <span class="cf">for</span> a <span class="kw">in</span> df_edges[df_edges[<span class="st">"type"</span>] <span class="op">==</span> edge_type][<span class="st">"source"</span>]]</span>
<span id="cb84-7"><a href=""></a>    mask2 <span class="op">=</span> [a <span class="kw">in</span> <span class="bu">list</span>(df_nodes[df_nodes[<span class="st">"type"</span>] <span class="op">==</span> target][<span class="st">'label'</span>]) <span class="cf">for</span> a <span class="kw">in</span> df_edges[df_edges[<span class="st">"type"</span>] <span class="op">==</span> edge_type][<span class="st">"target"</span>]]</span>
<span id="cb84-8"><a href=""></a>    mask <span class="op">=</span> [a <span class="op">&amp;</span> b <span class="cf">for</span> a,b <span class="kw">in</span> <span class="bu">zip</span>(mask1,mask2)]</span>
<span id="cb84-9"><a href=""></a>    <span class="cf">return</span> df_edges[df_edges[<span class="st">"type"</span>] <span class="op">==</span> edge_type][mask]</span>
<span id="cb84-10"><a href=""></a>df_edges_awarded <span class="op">=</span> my_func(<span class="st">"AWARDED"</span>, <span class="st">"PERSON"</span>, <span class="st">"AWARD"</span>)[[<span class="st">"source"</span>, <span class="st">"target"</span>]]</span>
<span id="cb84-11"><a href=""></a>df_edges_discovered <span class="op">=</span> my_func(<span class="st">"DISCOVERED"</span>, <span class="st">"PERSON"</span>, <span class="st">"DISCOVERY"</span>)[[<span class="st">"source"</span>, <span class="st">"target"</span>]]</span>
<span id="cb84-12"><a href=""></a>df_edges_visited <span class="op">=</span> my_func(<span class="st">"VISITED"</span>, <span class="st">"PERSON"</span>, <span class="st">"LOCATION"</span>)[[<span class="st">"source"</span>, <span class="st">"target"</span>]]</span>
<span id="cb84-13"><a href=""></a>df_edges_interpersonal_relationship <span class="op">=</span> my_func(<span class="st">"INTERPERSONALRELATIONSHIP"</span>, <span class="st">"PERSON"</span>, <span class="st">"PERSON"</span>)[[<span class="st">"source"</span>, <span class="st">"target"</span>]]</span>
<span id="cb84-14"><a href=""></a>conn.execute(<span class="st">"COPY Discovered FROM df_edges_discovered"</span>)<span class="op">;</span> <span class="co"># copy from dataframes</span></span>
<span id="cb84-15"><a href=""></a>conn.execute(<span class="st">"COPY Awarded FROM df_edges_awarded"</span>)<span class="op">;</span></span>
<span id="cb84-16"><a href=""></a>conn.execute(<span class="st">"COPY Visited FROM df_edges_visited"</span>)<span class="op">;</span></span>
<span id="cb84-17"><a href=""></a>conn.execute(<span class="st">"COPY Interpersonal_Relationship FROM df_edges_interpersonal_relationship"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="check-for-edges" class="slide level3">
<h3>Check for edges</h3>
<div id="0b73ebae-6b90-41ba-953d-b7005a5384fb" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:49:29.104971Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:49:29.104492Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:49:29.121790Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:49:29.120451Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:49:29.104926Z&quot;}" data-execution_count="82">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href=""></a>result <span class="op">=</span> conn.execute(<span class="st">"MATCH (a)-[:DISCOVERED]-&gt;(c) RETURN a.name, c.name;"</span>)</span>
<span id="cb85-2"><a href=""></a><span class="cf">while</span> result.has_next():</span>
<span id="cb85-3"><a href=""></a>    <span class="bu">print</span>(result.get_next())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['Marie Curie', 'Polonium']
['Marie Curie', 'Radium']
['Pierre Curie', 'Piezoelectricity']</code></pre>
</div>
</div>
</section>
</section>
<section>
<section id="kg-based-agents" class="title-slide slide level1 center">
<h1>KG-based Agents</h1>

</section>
<section id="section-20" class="slide level3 nostretch">
<h3></h3>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="./assets/KG-Agent.jpg" title="Knowledge Graph Based Agent" class="quarto-figure quarto-figure-center" style="width:80.0%"></p>
</figure>
</div>
</section>
<section id="tools" class="title-slide slide level2 center">
<h2>Tools</h2>

</section>
<section id="tool-query-checker" class="slide level3">
<h3>Tool: Query Checker</h3>
<div id="d2435b60-205e-478c-93f7-8c6112147dc7" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:49:30.157019Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:49:30.156549Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:49:30.163693Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:49:30.162303Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:49:30.156976Z&quot;}" data-execution_count="83">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href=""></a><span class="kw">def</span> build_kuzu_query_checker_prompt(cypher_query):</span>
<span id="cb87-2"><a href=""></a>    <span class="cf">return</span> (</span>
<span id="cb87-3"><a href=""></a>    <span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span>cypher_query<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb87-4"><a href=""></a>    <span class="st">"Double check the Kùzu dialect of Cypher for the query above "</span></span>
<span id="cb87-5"><a href=""></a>    <span class="st">"for common mistakes, including:</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb87-6"><a href=""></a>    <span class="st">"- Using the correct number of arguments for functions</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb87-7"><a href=""></a>    <span class="st">"- Casting to the correct data type</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb87-8"><a href=""></a>    <span class="st">"- Do not omit the relationship pattern.</span><span class="ch">\n</span><span class="st">"</span> </span>
<span id="cb87-9"><a href=""></a>    <span class="st">"- Always use `()-[]-&gt;()` instead of `()-&gt;()`.</span><span class="ch">\n\n</span><span class="st">"</span></span>
<span id="cb87-10"><a href=""></a>    <span class="st">"If there are any of the above mistakes, rewrite the query. "</span></span>
<span id="cb87-11"><a href=""></a>    <span class="st">"If there are no mistakes, just reproduce the original query.</span><span class="ch">\n\n</span><span class="st">"</span></span>
<span id="cb87-12"><a href=""></a>    <span class="st">"Output the final Kùzu Cypher query only.</span><span class="ch">\n\n</span><span class="st">"</span></span>
<span id="cb87-13"><a href=""></a>    <span class="st">"Kùzu Cypher Query: "</span></span>
<span id="cb87-14"><a href=""></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tool-query-checker-1" class="slide level3">
<h3>Tool: Query Checker</h3>
<div id="fa2b31ae-eaea-48c3-a0ca-256b3d124ec1" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:49:31.189880Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:49:31.189424Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:49:31.771877Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:49:31.770906Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:49:31.189837Z&quot;}" data-execution_count="84">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href=""></a><span class="kw">def</span> query_checker_tool(cypher_query):</span>
<span id="cb88-2"><a href=""></a>    user_prompt <span class="op">=</span> build_kuzu_query_checker_prompt(cypher_query)</span>
<span id="cb88-3"><a href=""></a>    response <span class="op">=</span> llm.create_chat_completion(</span>
<span id="cb88-4"><a href=""></a>        messages<span class="op">=</span>[{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: user_prompt}]</span>
<span id="cb88-5"><a href=""></a>    )</span>
<span id="cb88-6"><a href=""></a>    <span class="cf">return</span> response[<span class="st">"choices"</span>][<span class="dv">0</span>][<span class="st">"message"</span>][<span class="st">"content"</span>]</span>
<span id="cb88-7"><a href=""></a></span>
<span id="cb88-8"><a href=""></a></span>
<span id="cb88-9"><a href=""></a>query_checker_tool(</span>
<span id="cb88-10"><a href=""></a><span class="st">"MATCH (p:Person)-[:Discovered]-&lt;(:Discovery {name: 'Polonium'})</span><span class="ch">\n</span><span class="st">RETURN *"</span></span>
<span id="cb88-11"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="84">
<pre><code>"MATCH (p:Person)-[:Discovered]-&gt;(d:Discovery {name: 'Polonium'})\nRETURN *"</code></pre>
</div>
</div>
</section>
<section id="tool-query-generator-executor" class="slide level3">
<h3>Tool: Query Generator + Executor</h3>
<div id="abbf8a5f-9c19-4f79-bc73-cca923ce5278" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:49:33.055493Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:49:33.055025Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:49:33.098792Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:49:33.097204Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:49:33.055450Z&quot;}" data-execution_count="86">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href=""></a><span class="im">from</span> langchain_community.graphs <span class="im">import</span> KuzuGraph</span>
<span id="cb90-2"><a href=""></a></span>
<span id="cb90-3"><a href=""></a>graph_db_schema <span class="op">=</span> KuzuGraph(db).get_schema</span>
<span id="cb90-4"><a href=""></a><span class="bu">print</span>(graph_db_schema)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Node properties: [{'properties': [('name', 'STRING')], 'label': 'Person'}, {'properties': [('name', 'STRING')], 'label': 'Discovery'}, {'properties': [('name', 'STRING')], 'label': 'Award'}, {'properties': [('name', 'STRING')], 'label': 'Location'}]
Relationships properties: [{'properties': [], 'label': 'Awarded'}, {'properties': [], 'label': 'Discovered'}, {'properties': [], 'label': 'Interpersonal_Relationship'}, {'properties': [], 'label': 'Visited'}]
Relationships: ['(:Person)-[:Awarded]-&gt;(:Award)', '(:Person)-[:Discovered]-&gt;(:Discovery)', '(:Person)-[:Interpersonal_Relationship]-&gt;(:Person)', '(:Person)-[:Visited]-&gt;(:Location)']
</code></pre>
</div>
</div>
</section>
<section id="tool-query-generator-executor-1" class="slide level3">
<h3>Tool: Query Generator + Executor</h3>
<div id="185e930b-2ff3-4d59-90d2-43da580a266f" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:49:34.025622Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:49:34.025158Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:49:34.032624Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:49:34.031238Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:49:34.025580Z&quot;}" data-execution_count="87">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href=""></a><span class="kw">def</span> build_kuzu_prompt(query, graph_db_schema<span class="op">=</span>graph_db_schema):</span>
<span id="cb92-2"><a href=""></a>    <span class="cf">return</span> <span class="st">"""Task: Generate Kùzu Cypher statement to query a graph database.</span></span>
<span id="cb92-3"><a href=""></a></span>
<span id="cb92-4"><a href=""></a><span class="st">Instructions:</span></span>
<span id="cb92-5"><a href=""></a><span class="st">Generate the Kùzu dialect of Cypher with the following rules in mind:</span></span>
<span id="cb92-6"><a href=""></a><span class="st">1. Do not omit the relationship pattern. Always use `()-[]-&gt;()` instead of `()-&gt;()`.</span></span>
<span id="cb92-7"><a href=""></a><span class="st">2. Do not include triple backticks ``` in your response. Return only Cypher.</span></span>
<span id="cb92-8"><a href=""></a><span class="st">3. Do not return any notes or comments in your response.</span></span>
<span id="cb92-9"><a href=""></a></span>
<span id="cb92-10"><a href=""></a><span class="st">Use only the provided relationship types and properties in the schema.</span></span>
<span id="cb92-11"><a href=""></a><span class="st">Do not use any other relationship types or properties that are not provided.</span></span>
<span id="cb92-12"><a href=""></a><span class="st">Schema:</span><span class="ch">\n</span><span class="st">"""</span> <span class="op">+</span> graph_db_schema <span class="op">+</span> <span class="st">"""</span></span>
<span id="cb92-13"><a href=""></a><span class="ch">\n</span><span class="st">Example:</span></span>
<span id="cb92-14"><a href=""></a><span class="st">The question is:</span><span class="ch">\n</span><span class="st">"Which songs does the load album have?"</span></span>
<span id="cb92-15"><a href=""></a><span class="st">MATCH (a:ALBUM {name: 'Load'})&lt;-[:IN_ALBUM]-(s:SONG) RETURN s.name</span></span>
<span id="cb92-16"><a href=""></a><span class="st">Note: Do not include any explanations or apologies in your responses.</span></span>
<span id="cb92-17"><a href=""></a><span class="st">Do not respond to any questions that might ask anything else than for you to construct a Cypher statement.</span></span>
<span id="cb92-18"><a href=""></a><span class="st">Do not include any text except the generated Cypher statement.</span></span>
<span id="cb92-19"><a href=""></a></span>
<span id="cb92-20"><a href=""></a><span class="st">The question is:</span><span class="ch">\n</span><span class="st">"""</span> <span class="op">+</span> query</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tool-query-generator-executor-2" class="slide level3">
<h3>Tool: Query Generator + Executor</h3>
<div id="37dfc608-8bc4-4c95-a381-bd116f620b2d" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:49:34.939472Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:49:34.938615Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:49:36.476449Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:49:36.475804Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:49:34.939425Z&quot;}" data-execution_count="88">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href=""></a><span class="kw">def</span> query_generator_tool(query):</span>
<span id="cb93-2"><a href=""></a>    user_prompt <span class="op">=</span> build_kuzu_prompt(query)</span>
<span id="cb93-3"><a href=""></a>    output <span class="op">=</span> llm.create_chat_completion(</span>
<span id="cb93-4"><a href=""></a>        messages <span class="op">=</span> [{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: user_prompt}]</span>
<span id="cb93-5"><a href=""></a>    )</span>
<span id="cb93-6"><a href=""></a>    cypher_query <span class="op">=</span> output[<span class="st">'choices'</span>][<span class="dv">0</span>][<span class="st">'message'</span>][<span class="st">'content'</span>]</span>
<span id="cb93-7"><a href=""></a>    cypher_query <span class="op">=</span> query_checker_tool(cypher_query)</span>
<span id="cb93-8"><a href=""></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\x1b</span><span class="ss">[33m Cypher query: </span><span class="sc">{</span>cypher_query<span class="sc">}</span><span class="ss"> </span><span class="ch">\x1b</span><span class="ss">[0m"</span>)</span>
<span id="cb93-9"><a href=""></a>    response <span class="op">=</span> conn.execute(<span class="ss">f"</span><span class="sc">{</span>cypher_query<span class="sc">}</span><span class="ss">"</span>)<span class="op">;</span></span>
<span id="cb93-10"><a href=""></a>    df <span class="op">=</span> response.get_as_pl()</span>
<span id="cb93-11"><a href=""></a>    col_name <span class="op">=</span> df.columns[<span class="dv">0</span>]</span>
<span id="cb93-12"><a href=""></a>    _values <span class="op">=</span> df[col_name].to_list()</span>
<span id="cb93-13"><a href=""></a>    <span class="cf">return</span> <span class="ss">f"[</span><span class="sc">{</span>col_name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>_values<span class="sc">}</span><span class="ss">]"</span></span>
<span id="cb93-14"><a href=""></a>query_generator_tool(<span class="st">"What discovery is Marie Curie famous for?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Cypher query: MATCH (p:Person {name: 'Marie Curie'})-[:Discovered]-&gt;(d:Discovery) RETURN d.name </code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="88">
<pre><code>"[d.name: ['Radium', 'Polonium']]"</code></pre>
</div>
</div>
</section>
<section id="tool-conversational-response" class="slide level3">
<h3>Tool: Conversational Response</h3>
<div id="d642ad6a-872d-487c-9d33-07833e5fa25d" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:49:38.831338Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:49:38.830847Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:49:38.837249Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:49:38.835949Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:49:38.831291Z&quot;}" data-execution_count="90">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href=""></a><span class="kw">def</span> conversational_response(text):</span>
<span id="cb96-2"><a href=""></a>    <span class="cf">return</span> text</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="react-agent" class="title-slide slide level2 center">
<h2>ReAct agent</h2>
<div id="27717ff4-7a0e-4e1f-a520-034bc61336fb" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:49:40.445388Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:49:40.444918Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:49:40.455521Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:49:40.454304Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:49:40.445343Z&quot;}" data-execution_count="92">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href=""></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel, Field</span>
<span id="cb97-2"><a href=""></a></span>
<span id="cb97-3"><a href=""></a></span>
<span id="cb97-4"><a href=""></a><span class="kw">class</span> Reason_and_Act(BaseModel):</span>
<span id="cb97-5"><a href=""></a>    Scratchpad: <span class="bu">str</span> <span class="op">=</span> Field(</span>
<span id="cb97-6"><a href=""></a>        ...,</span>
<span id="cb97-7"><a href=""></a>        description<span class="op">=</span><span class="st">"Information from the Observation useful to answer the question"</span>,</span>
<span id="cb97-8"><a href=""></a>    )</span>
<span id="cb97-9"><a href=""></a>    Thought: <span class="bu">str</span> <span class="op">=</span> Field(</span>
<span id="cb97-10"><a href=""></a>        ...,</span>
<span id="cb97-11"><a href=""></a>        description<span class="op">=</span><span class="st">"It describes your thoughts about the question you have been asked"</span>,</span>
<span id="cb97-12"><a href=""></a>    )</span>
<span id="cb97-13"><a href=""></a>    Action: Literal[<span class="st">"conversational_response"</span>, <span class="st">"query_generator"</span>, <span class="st">"query_checker"</span>] <span class="op">=</span> (</span>
<span id="cb97-14"><a href=""></a>        Field(..., description<span class="op">=</span><span class="st">"The action to take"</span>)</span>
<span id="cb97-15"><a href=""></a>    )</span>
<span id="cb97-16"><a href=""></a>    Action_Input: <span class="bu">str</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"The arguments of the Action."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="react-agent-1" class="slide level3">
<h3>ReAct Agent</h3>
<div id="b1a533cf-d7da-4d06-9b79-0fd346c08715" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:49:41.631936Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:49:41.631333Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:49:41.639719Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:49:41.638515Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:49:41.631891Z&quot;}" data-execution_count="93">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href=""></a><span class="kw">class</span> Final_Answer(BaseModel):</span>
<span id="cb98-2"><a href=""></a>    Scratchpad: <span class="bu">str</span> <span class="op">=</span> Field(</span>
<span id="cb98-3"><a href=""></a>        ...,</span>
<span id="cb98-4"><a href=""></a>        description<span class="op">=</span><span class="st">"Information from the Observation useful to answer the question"</span>,</span>
<span id="cb98-5"><a href=""></a>    )</span>
<span id="cb98-6"><a href=""></a>    Final_Answer: <span class="bu">str</span> <span class="op">=</span> Field(</span>
<span id="cb98-7"><a href=""></a>        ..., description<span class="op">=</span><span class="st">"Answer to the question grounded on the Observation"</span></span>
<span id="cb98-8"><a href=""></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="react-agent-2" class="slide level3">
<h3>ReAct Agent</h3>
<div id="dd910b2a-7e44-4d80-901a-703d53c1c139" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:49:42.741034Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:49:42.740428Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:49:42.748268Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:49:42.747026Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:49:42.740987Z&quot;}" data-execution_count="94">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href=""></a><span class="kw">class</span> Decision(BaseModel):</span>
<span id="cb99-2"><a href=""></a>    Decision: Reason_and_Act <span class="op">|</span> Final_Answer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="react-agent-3" class="slide level3">
<h3>ReAct Agent</h3>
<div id="689d319e-f4bc-4ece-b208-5500400137c6" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:49:44.130606Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:49:44.130003Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:49:44.141653Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:49:44.140428Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:49:44.130561Z&quot;}" data-execution_count="95">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href=""></a><span class="im">from</span> outlines <span class="im">import</span> generate, models</span>
<span id="cb100-2"><a href=""></a><span class="im">from</span> outlines.fsm.json_schema <span class="im">import</span> build_regex_from_schema, convert_json_schema_to_str</span>
<span id="cb100-3"><a href=""></a></span>
<span id="cb100-4"><a href=""></a>model <span class="op">=</span> models.LlamaCpp(llm)</span>
<span id="cb100-5"><a href=""></a>schema_str <span class="op">=</span> convert_json_schema_to_str(json_schema<span class="op">=</span>Decision.schema_json())</span>
<span id="cb100-6"><a href=""></a>regex_str <span class="op">=</span> build_regex_from_schema(schema_str)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="react-agent-4" class="slide level3">
<h3>ReAct Agent</h3>
<div id="2e4efc83-ce6c-4cec-b5e3-c9ceb9acd169" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:49:45.582686Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:49:45.582207Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:49:45.590830Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:49:45.589629Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:49:45.582642Z&quot;}" data-execution_count="96">
<div class="sourceCode cell-code" id="cb101" data-code-line-numbers="1-27|6-7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href=""></a><span class="kw">def</span> generate_hermes_prompt(question, schema<span class="op">=</span><span class="st">""</span>):</span>
<span id="cb101-2"><a href=""></a>    <span class="cf">return</span> (</span>
<span id="cb101-3"><a href=""></a>        <span class="st">"&lt;|im_start|&gt;system</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb101-4"><a href=""></a>        <span class="st">"You are a world class AI model who answers questions in JSON with correct Pydantic schema."</span></span>
<span id="cb101-5"><a href=""></a>        <span class="ss">f"</span><span class="ch">\n</span><span class="ss">Here's the JSON schema you must adhere to:</span><span class="ch">\n</span><span class="ss">&lt;schema&gt;</span><span class="ch">\n</span><span class="sc">{</span>schema<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/schema&gt;</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb101-6"><a href=""></a>        <span class="st">"You run in a loop of Scratchpad, Thought, Action, Action Input, PAUSE, Observation."</span></span>
<span id="cb101-7"><a href=""></a>        <span class="st">"</span><span class="ch">\n</span><span class="st">At the end of the loop you output a Final Answer. "</span></span>
<span id="cb101-8"><a href=""></a>        <span class="st">"</span><span class="ch">\n</span><span class="st">- Use Scratchpad to store the information from the observation useful to answer the question"</span></span>
<span id="cb101-9"><a href=""></a>        <span class="st">"</span><span class="ch">\n</span><span class="st">- Use Thought to describe your thoughts about the question you have been asked "</span></span>
<span id="cb101-10"><a href=""></a>        <span class="st">"and reflect carefully about the Observation if it exists. "</span></span>
<span id="cb101-11"><a href=""></a>        <span class="st">"</span><span class="ch">\n</span><span class="st">- Use Action to run one of the actions available to you. "</span></span>
<span id="cb101-12"><a href=""></a>        <span class="st">"</span><span class="ch">\n</span><span class="st">- Use Action Input to input the arguments of the selected action - then return PAUSE. "</span></span>
<span id="cb101-13"><a href=""></a>        <span class="st">"</span><span class="ch">\n</span><span class="st">- Observation will be the result of running those actions. "</span></span>
<span id="cb101-14"><a href=""></a>        <span class="st">"</span><span class="ch">\n</span><span class="st">Your available actions are:</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb101-15"><a href=""></a>        <span class="st">"query_generator:</span><span class="ch">\n</span><span class="st">"</span> </span>
<span id="cb101-16"><a href=""></a>        <span class="st">"e.g. query_generator: Who is Marie Curie related to?</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb101-17"><a href=""></a>        <span class="st">"Returns a detailed and correct Kùzu Cypher query</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb101-18"><a href=""></a>        <span class="st">"query_checker:</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb101-19"><a href=""></a>        <span class="st">"e.g. query_checker: MATCH (a:ALBUM {name: 'The Black Album'})&lt;-[:IN_ALBUM]-(s:SONG) RETURN COUNT(s)</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb101-20"><a href=""></a>        <span class="st">"Returns a detailed and correct Kùzu Cypher query after double checking the query for common mistakes</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb101-21"><a href=""></a>        <span class="st">"conversational_reponse:"</span></span>
<span id="cb101-22"><a href=""></a>        <span class="st">"e.g. conversational_response: Hi!</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb101-23"><a href=""></a>        <span class="st">"Returns a conversational response to the user</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb101-24"><a href=""></a>        <span class="st">"DO NOT TRY TO GUESS THE ANSWER. Begin! &lt;|im_end|&gt;"</span></span>
<span id="cb101-25"><a href=""></a>        <span class="st">"</span><span class="ch">\n</span><span class="st">&lt;|im_start|&gt;user</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> question <span class="op">+</span> <span class="st">"&lt;|im_end|&gt;"</span></span>
<span id="cb101-26"><a href=""></a>        <span class="st">"</span><span class="ch">\n</span><span class="st">&lt;|im_start|&gt;assistant</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb101-27"><a href=""></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="react-agent-5" class="slide level3">
<h3>ReAct Agent</h3>
<div id="db23580f-efd0-417e-8e1a-e12247342d80" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:49:46.571626Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:49:46.571151Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:49:46.579802Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:49:46.578284Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:49:46.571581Z&quot;}" data-execution_count="97">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href=""></a><span class="kw">class</span> ChatBot:</span>
<span id="cb102-2"><a href=""></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, prompt<span class="op">=</span><span class="st">""</span>):</span>
<span id="cb102-3"><a href=""></a>        <span class="va">self</span>.prompt <span class="op">=</span> prompt</span>
<span id="cb102-4"><a href=""></a></span>
<span id="cb102-5"><a href=""></a>    <span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>, user_prompt):</span>
<span id="cb102-6"><a href=""></a>        <span class="va">self</span>.prompt <span class="op">+=</span> user_prompt</span>
<span id="cb102-7"><a href=""></a>        result <span class="op">=</span> <span class="va">self</span>.execute()</span>
<span id="cb102-8"><a href=""></a>        <span class="cf">return</span> result</span>
<span id="cb102-9"><a href=""></a>        </span>
<span id="cb102-10"><a href=""></a>    <span class="kw">def</span> execute(<span class="va">self</span>):</span>
<span id="cb102-11"><a href=""></a>        generator <span class="op">=</span> generate.regex(model, regex_str)</span>
<span id="cb102-12"><a href=""></a>        result <span class="op">=</span> generator(<span class="va">self</span>.prompt, max_tokens<span class="op">=</span><span class="dv">1024</span>, temperature<span class="op">=</span><span class="dv">0</span>, seed<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb102-13"><a href=""></a>        <span class="cf">return</span> result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="react-agent-6" class="slide level3">
<h3>ReAct Agent</h3>
<div id="fa683139-0d7a-4be8-a783-6b0362b4ad00" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:49:47.589011Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:49:47.588549Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:49:47.604159Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:49:47.602720Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:49:47.588968Z&quot;}" data-execution_count="98">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href=""></a><span class="im">import</span> json</span>
<span id="cb103-2"><a href=""></a></span>
<span id="cb103-3"><a href=""></a><span class="kw">def</span> query(question, max_turns<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb103-4"><a href=""></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb103-5"><a href=""></a>    next_prompt <span class="op">=</span> (</span>
<span id="cb103-6"><a href=""></a>        <span class="st">"</span><span class="ch">\n</span><span class="st">&lt;|im_start|&gt;user</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> question <span class="op">+</span> <span class="st">"&lt;|im_end|&gt;"</span></span>
<span id="cb103-7"><a href=""></a>        <span class="st">"</span><span class="ch">\n</span><span class="st">&lt;|im_start|&gt;assistant</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb103-8"><a href=""></a>    )</span>
<span id="cb103-9"><a href=""></a>    previous_actions <span class="op">=</span> []</span>
<span id="cb103-10"><a href=""></a>    <span class="cf">while</span> i <span class="op">&lt;</span> max_turns:</span>
<span id="cb103-11"><a href=""></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb103-12"><a href=""></a>        prompt <span class="op">=</span> generate_hermes_prompt(question<span class="op">=</span>question, schema<span class="op">=</span>Decision.schema_json())</span>
<span id="cb103-13"><a href=""></a>        bot <span class="op">=</span> ChatBot(prompt<span class="op">=</span>prompt)</span>
<span id="cb103-14"><a href=""></a>        result <span class="op">=</span> bot(next_prompt)</span>
<span id="cb103-15"><a href=""></a>        json_result <span class="op">=</span> json.loads(result)[<span class="st">'Decision'</span>]</span>
<span id="cb103-16"><a href=""></a>        <span class="cf">if</span> <span class="st">"Final_Answer"</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">list</span>(json_result.keys()):</span>
<span id="cb103-17"><a href=""></a>            scratchpad <span class="op">=</span> json_result[<span class="st">'Scratchpad'</span>] <span class="cf">if</span> i <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">""</span></span>
<span id="cb103-18"><a href=""></a>            thought <span class="op">=</span> json_result[<span class="st">'Thought'</span>]</span>
<span id="cb103-19"><a href=""></a>            action <span class="op">=</span> json_result[<span class="st">'Action'</span>]</span>
<span id="cb103-20"><a href=""></a>            action_input <span class="op">=</span> json_result[<span class="st">'Action_Input'</span>]</span>
<span id="cb103-21"><a href=""></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\x1b</span><span class="ss">[34m Scratchpad: </span><span class="sc">{</span>scratchpad<span class="sc">}</span><span class="ss"> </span><span class="ch">\x1b</span><span class="ss">[0m"</span>)</span>
<span id="cb103-22"><a href=""></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\x1b</span><span class="ss">[34m Thought: </span><span class="sc">{</span>thought<span class="sc">}</span><span class="ss"> </span><span class="ch">\x1b</span><span class="ss">[0m"</span>)</span>
<span id="cb103-23"><a href=""></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\x1b</span><span class="ss">[36m  -- running </span><span class="sc">{</span>action<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">str</span>(action_input)<span class="sc">}</span><span class="ch">\x1b</span><span class="ss">[0m"</span>)</span>
<span id="cb103-24"><a href=""></a>            <span class="cf">if</span> action <span class="op">+</span> <span class="st">": "</span> <span class="op">+</span> <span class="bu">str</span>(action_input) <span class="kw">in</span> previous_actions:</span>
<span id="cb103-25"><a href=""></a>                observation <span class="op">=</span> <span class="st">"You already run that action. **TRY A DIFFERENT ACTION INPUT.**"</span></span>
<span id="cb103-26"><a href=""></a>            <span class="cf">else</span>:</span>
<span id="cb103-27"><a href=""></a>                <span class="cf">if</span> action<span class="op">==</span><span class="st">"query_checker"</span>:</span>
<span id="cb103-28"><a href=""></a>                    <span class="cf">try</span>:</span>
<span id="cb103-29"><a href=""></a>                        observation <span class="op">=</span> query_checker_tool(<span class="bu">str</span>(action_input))</span>
<span id="cb103-30"><a href=""></a>                    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb103-31"><a href=""></a>                        observation <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb103-32"><a href=""></a>                <span class="cf">elif</span> action<span class="op">==</span><span class="st">"query_generator"</span>:</span>
<span id="cb103-33"><a href=""></a>                    <span class="cf">try</span>:</span>
<span id="cb103-34"><a href=""></a>                        observation <span class="op">=</span> query_generator_tool(<span class="bu">str</span>(action_input))</span>
<span id="cb103-35"><a href=""></a>                    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb103-36"><a href=""></a>                        observation <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb103-37"><a href=""></a>                <span class="cf">elif</span> action<span class="op">==</span><span class="st">"conversational_response"</span>:</span>
<span id="cb103-38"><a href=""></a>                    <span class="cf">try</span>:</span>
<span id="cb103-39"><a href=""></a>                        observation <span class="op">=</span> conversational_response(<span class="bu">str</span>(action_input))</span>
<span id="cb103-40"><a href=""></a>                        observation <span class="op">+=</span> <span class="st">"</span><span class="ch">\n</span><span class="st">Answer to the user."</span></span>
<span id="cb103-41"><a href=""></a>                    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb103-42"><a href=""></a>                        observation <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb103-43"><a href=""></a>            <span class="bu">print</span>()</span>
<span id="cb103-44"><a href=""></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\x1b</span><span class="ss">[33m Observation: </span><span class="sc">{</span>observation<span class="sc">}</span><span class="ss"> </span><span class="ch">\x1b</span><span class="ss">[0m"</span>)</span>
<span id="cb103-45"><a href=""></a>            <span class="bu">print</span>()</span>
<span id="cb103-46"><a href=""></a>            previous_actions.append(action <span class="op">+</span> <span class="st">": "</span> <span class="op">+</span> <span class="bu">str</span>(action_input))</span>
<span id="cb103-47"><a href=""></a>            next_prompt <span class="op">+=</span> (</span>
<span id="cb103-48"><a href=""></a>                <span class="st">"</span><span class="ch">\n</span><span class="st">Scratchpad: "</span> <span class="op">+</span> scratchpad <span class="op">+</span></span>
<span id="cb103-49"><a href=""></a>                <span class="st">"</span><span class="ch">\n</span><span class="st">Thought: "</span> <span class="op">+</span> thought <span class="op">+</span></span>
<span id="cb103-50"><a href=""></a>                <span class="st">"</span><span class="ch">\n</span><span class="st">Action: "</span> <span class="op">+</span> action  <span class="op">+</span></span>
<span id="cb103-51"><a href=""></a>                <span class="st">"</span><span class="ch">\n</span><span class="st">Action Input: "</span> <span class="op">+</span> action_input <span class="op">+</span></span>
<span id="cb103-52"><a href=""></a>                <span class="st">"</span><span class="ch">\n</span><span class="st">Observation: "</span> <span class="op">+</span> <span class="bu">str</span>(observation)</span>
<span id="cb103-53"><a href=""></a>            )</span>
<span id="cb103-54"><a href=""></a>        <span class="cf">else</span>:</span>
<span id="cb103-55"><a href=""></a>            scratchpad <span class="op">=</span> json_result[<span class="st">"Scratchpad"</span>]</span>
<span id="cb103-56"><a href=""></a>            final_answer <span class="op">=</span> json_result[<span class="st">"Final_Answer"</span>]</span>
<span id="cb103-57"><a href=""></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\x1b</span><span class="ss">[34m Scratchpad: </span><span class="sc">{</span>scratchpad<span class="sc">}</span><span class="ss"> </span><span class="ch">\x1b</span><span class="ss">[0m"</span>)</span>
<span id="cb103-58"><a href=""></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\x1b</span><span class="ss">[34m Final Answer: </span><span class="sc">{</span>final_answer<span class="sc">}</span><span class="ss"> </span><span class="ch">\x1b</span><span class="ss">[0m"</span>)</span>
<span id="cb103-59"><a href=""></a>            <span class="cf">return</span> final_answer</span>
<span id="cb103-60"><a href=""></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Final Answer: I am sorry, but I am unable to answer your question. Please provide more information or a different question."</span>)</span>
<span id="cb103-61"><a href=""></a>    <span class="cf">return</span> <span class="st">"No answer found"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="react-agent-7" class="slide level3">
<h3>ReAct Agent</h3>
<div id="3c53a402-9ab6-40de-aaef-7620c52fbc65" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:49:48.782916Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:49:48.782461Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:49:55.137911Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:49:55.136732Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:49:48.782875Z&quot;}" data-execution_count="99">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href=""></a>query(<span class="st">"Query the database to see which discovery did Pierre Curie do?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Scratchpad:  
 Thought: To find out which discovery Pierre Curie is known for, I should query the database for information about his scientific contributions. 
  -- running query_generator: MATCH (p:PERSON {name: 'Pierre Curie'})-[:DISCOVERED]-&gt;(d:DISCOVERY) RETURN d.name
 Cypher query: MATCH (p:PERSON {name: 'Pierre Curie'})-[:DISCOVERED]-&gt;(d:DISCOVERY) RETURN d.name 

 Observation: [d.name: ['Piezoelectricity']] 

 Scratchpad: Pierre Curie is known for discovering piezoelectricity. 
 Final Answer: Pierre Curie discovered piezoelectricity. </code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="99">
<pre><code>'Pierre Curie discovered piezoelectricity.'</code></pre>
</div>
</div>
</section>
<section id="react-agent-8" class="slide level3">
<h3>ReAct Agent</h3>
<div id="d97abeac-ce4f-4959-be90-9ad2b858d105" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:50:02.958190Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:50:02.957682Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:50:09.436774Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:50:09.436031Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:50:02.958145Z&quot;}" data-execution_count="100">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href=""></a>query(<span class="st">"Query the database to see which discovery did Marie Curie do?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Scratchpad:  
 Thought: To find out which discovery Marie Curie is known for, I will query the database to search for her discoveries. 
  -- running query_generator: MATCH (p:PERSON {name: 'Marie Curie'})-[:DISCOVERED]-&gt;(d:DISCOVERY) RETURN d.name
 Cypher query: MATCH (p:PERSON {name: 'Marie Curie'})-[:DISCOVERED]-&gt;(d:DISCOVERY) RETURN d.name 

 Observation: [d.name: ['Radium', 'Polonium']] 

 Scratchpad: Marie Curie is known for discovering Radium and Polonium. 
 Final Answer: Marie Curie discovered Radium and Polonium. </code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="100">
<pre><code>'Marie Curie discovered Radium and Polonium.'</code></pre>
</div>
</div>
</section>
<section id="react-agent-9" class="slide level3">
<h3>ReAct Agent</h3>
<div id="7081b3ab-2cdb-4ec3-90f8-56db1f5d53f0" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-08T08:50:10.950616Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-08T08:50:10.950105Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-08T08:50:14.994450Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-08T08:50:14.993647Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-08T08:50:10.950573Z&quot;}" data-execution_count="101">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href=""></a>query(<span class="st">"Tell me a joke."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Scratchpad:  
 Thought: To provide a joke, I will use my knowledge base to find a suitable joke that is appropriate for all ages. 
  -- running conversational_response: Tell a family-friendly joke.

 Observation: Tell a family-friendly joke.
Answer to the user. 

 Scratchpad: To provide a joke, I will use my knowledge base to find a suitable joke that is appropriate for all ages. 
 Final Answer: Why don't scientists trust atoms? Because they make up everything! </code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="101">
<pre><code>"Why don't scientists trust atoms? Because they make up everything!"</code></pre>
</div>
</div>
</section>
</section>
<section>
<section id="conclusions" class="title-slide slide level1 center">
<h1>Conclusions</h1>

</section>
<section id="conclusions-1" class="slide level3">
<h3>Conclusions</h3>
<ul>
<li>The goal is to provide better context to the LLM prior to generating its response</li>
<li>Combining graph + vector retrieval help us to achieve this goal better than vector-only retrieval or graph-only retrieval</li>
<li>Structured Outputs + Structured Generation help us to generate Knowledge Graphs from unstructured data</li>
<li>Structured Outputs + Structured Generation help us create KG-based Agents that can query graph databases as well as calling other tools</li>
</ul>
</section>
<section id="references" class="slide level3" data-visibility="uncounted">
<h3>References</h3>
<ul>
<li><a href="https://neo4j.com/developer-blog/enhance-rag-knowledge-graph/">Enhancing the Accuracy of RAG Applications With Knowledge Graphs</a> by Tomaž Bratanič</li>
<li><a href="https://neo4j.com/developer-blog/genai-powered-song-finder/">A GenAI-Powered Song Finder in Four Lines of Code</a> by Christoffer Bergman</li>
<li><a href="https://github.com/kuzudb/graph-rag">Graph RAG strategies using Kùzu</a> by Prashanth Rao</li>
<li><a href="https://blog.dottxt.co/coalescence.html">Coalescence</a> by <a href="https://twitter.com/willkurt">Will Kurt</a></li>
<li><a href="https://github.com/vivien000/regex-constrained-decoding">Fast, High-Fidelity LLM Decoding with Regex Constraints</a> by <a href="https://github.com/vivien000">Vivien Tran-Thien</a></li>
<li><a href="https://til.simonwillison.net/llms/python-react-pattern">A simple Python implementation of the ReAct pattern for LLMs</a> by <a href="https://simonwillison.net/">Simon Willison</a></li>
<li><a href="https://github.com/lancedb/lancedb">LanceDB</a> (vector DB) + <a href="https://github.com/kuzudb/kuzu">Kùzu</a> (graph DB) + <a href="https://github.com/abetlen/llama-cpp-python">Llama.cpp</a> (inference) + <a href="https://dottxt-ai.github.io/outlines/">Outlines</a> (structured generation) + <a href="https://github.com/langchain-ai/langchain">LangChain</a> (framework) + <a href="https://github.com/widgetti/solara">Solara</a> (visualization)</li>
</ul>
</section>
<section id="how-was-my-presentation" class="slide level3" data-visibility="uncounted">
<h3>How was my presentation?</h3>
<p>Please, leave me your anonymous feedback at <a href="https://www.admonymous.co/alonsosilva">https://www.admonymous.co/alonsosilva</a></p>

</section><div class="quarto-auto-generated-content">
<div class="footer footer-default">

</div>
</div></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="IADevs_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="IADevs_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="IADevs_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="IADevs_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="IADevs_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="IADevs_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="IADevs_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="IADevs_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="IADevs_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="IADevs_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>